<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>C A closer look at trends | The openair book</title>
  <meta name="description" content="Analysing air quality data with the openair package" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="C A closer look at trends | The openair book" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="Analysing air quality data with the openair package" />
  <meta name="github-repo" content="davidcarslaw/openair-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="C A closer look at trends | The openair book" />
  
  <meta name="twitter:description" content="Analysing air quality data with the openair package" />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="David C. Carslaw" />


<meta name="date" content="2020-11-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sec-prod-hyspl-traj.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The openair book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#hello-and-welcome"><i class="fa fa-check"></i>Hello and welcome</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="sec-openair-package.html"><a href="sec-openair-package.html"><i class="fa fa-check"></i><b>2</b> The openair package</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sec-openair-package.html"><a href="sec-openair-package.html#installation-and-code-access"><i class="fa fa-check"></i><b>2.1</b> Installation and code access</a></li>
<li class="chapter" data-level="2.2" data-path="sec-openair-package.html"><a href="sec-openair-package.html#input-data-requirements"><i class="fa fa-check"></i><b>2.2</b> Input data requirements</a></li>
<li class="chapter" data-level="2.3" data-path="sec-openair-package.html"><a href="sec-openair-package.html#sec:brief-intr-open"><i class="fa fa-check"></i><b>2.3</b> Brief overview of openair</a></li>
<li class="chapter" data-level="2.4" data-path="sec-openair-package.html"><a href="sec-openair-package.html#the-type-option"><i class="fa fa-check"></i><b>2.4</b> The type option</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="sec-openair-package.html"><a href="sec-openair-package.html#make-your-own-type"><i class="fa fa-check"></i><b>2.4.1</b> Make your own type</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="sec-openair-package.html"><a href="sec-openair-package.html#sec:font-size"><i class="fa fa-check"></i><b>2.5</b> Controlling font size</a></li>
<li class="chapter" data-level="2.6" data-path="sec-openair-package.html"><a href="sec-openair-package.html#sec:colours"><i class="fa fa-check"></i><b>2.6</b> Using colours</a></li>
<li class="chapter" data-level="2.7" data-path="sec-openair-package.html"><a href="sec-openair-package.html#sec:quickText"><i class="fa fa-check"></i><b>2.7</b> Automatic text formatting</a></li>
<li class="chapter" data-level="2.8" data-path="sec-openair-package.html"><a href="sec-openair-package.html#sec:multiple-plots-page"><i class="fa fa-check"></i><b>2.8</b> Multiple plots on a page</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sec-importAURN.html"><a href="sec-importAURN.html"><i class="fa fa-check"></i><b>3</b> Accessing UK Air Quality Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec-importAURN.html"><a href="sec-importAURN.html#accessing-data"><i class="fa fa-check"></i><b>3.1</b> Accessing data</a></li>
<li class="chapter" data-level="3.2" data-path="sec-importAURN.html"><a href="sec-importAURN.html#site-meta-data"><i class="fa fa-check"></i><b>3.2</b> Site Meta Data</a></li>
<li class="chapter" data-level="3.3" data-path="sec-importAURN.html"><a href="sec-importAURN.html#plot-sites-on-a-map"><i class="fa fa-check"></i><b>3.3</b> Plot Sites on a Map</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sec-worldmet.html"><a href="sec-worldmet.html"><i class="fa fa-check"></i><b>4</b> Access meteorological data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec-worldmet.html"><a href="sec-worldmet.html#the-worldmet-package"><i class="fa fa-check"></i><b>4.1</b> The worldmet package</a></li>
<li class="chapter" data-level="4.2" data-path="sec-worldmet.html"><a href="sec-worldmet.html#sec:link-aq"><i class="fa fa-check"></i><b>4.2</b> Linking with air quality data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec-windRose.html"><a href="sec-windRose.html"><i class="fa fa-check"></i><b>5</b> Wind and Pollution Roses</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sec-windRose.html"><a href="sec-windRose.html#example-of-use"><i class="fa fa-check"></i><b>5.1</b> Example of use</a></li>
<li class="chapter" data-level="5.2" data-path="sec-windRose.html"><a href="sec-windRose.html#sec:comp-met"><i class="fa fa-check"></i><b>5.2</b> Comparing two meteorological data sets</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sec-polarFreq.html"><a href="sec-polarFreq.html"><i class="fa fa-check"></i><b>6</b> Polar frequencies</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec-polarFreq.html"><a href="sec-polarFreq.html#sec:polarFreqBack"><i class="fa fa-check"></i><b>6.1</b> Background and examples</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html"><i class="fa fa-check"></i><b>7</b> Percentile roses</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html#examples"><i class="fa fa-check"></i><b>7.2</b> Examples</a></li>
<li class="chapter" data-level="7.3" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html#sec:CPF"><i class="fa fa-check"></i><b>7.3</b> Condtional probability function</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html"><i class="fa fa-check"></i><b>8</b> Polar plots</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#introduction-to-polar-plots"><i class="fa fa-check"></i><b>8.1</b> Introduction to polar plots</a></li>
<li class="chapter" data-level="8.2" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#polar-plot-examples"><i class="fa fa-check"></i><b>8.2</b> Examples</a></li>
<li class="chapter" data-level="8.3" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#nonparametric-wind-regression-nwr"><i class="fa fa-check"></i><b>8.3</b> Nonparametric Wind Regression, NWR</a></li>
<li class="chapter" data-level="8.4" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#conditional-probability-function-cpf-plot"><i class="fa fa-check"></i><b>8.4</b> Conditional Probability Function (CPF) plot</a></li>
<li class="chapter" data-level="8.5" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#pairwise-statistics"><i class="fa fa-check"></i><b>8.5</b> Pairwise statistics</a></li>
<li class="chapter" data-level="8.6" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#sec:polar-compare"><i class="fa fa-check"></i><b>8.6</b> Comparing two time periods</a></li>
<li class="chapter" data-level="8.7" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#sec:polarCluster"><i class="fa fa-check"></i><b>8.7</b> Clustering</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#clustering-concentrations"><i class="fa fa-check"></i><b>8.7.1</b> Clustering concentrations</a></li>
<li class="chapter" data-level="8.7.2" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#clustering-differences-in-concentrations"><i class="fa fa-check"></i><b>8.7.2</b> Clustering differences in concentrations</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#polar-plots-on-an-interactive-map"><i class="fa fa-check"></i><b>8.8</b> Polar plots on an interactive map</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="sec-polarAnnulus.html"><a href="sec-polarAnnulus.html"><i class="fa fa-check"></i><b>9</b> Polar annulus</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec-polarAnnulus.html"><a href="sec-polarAnnulus.html#polarAnnulusBack"><i class="fa fa-check"></i><b>9.1</b> Purpose</a></li>
<li class="chapter" data-level="9.2" data-path="sec-polarAnnulus.html"><a href="sec-polarAnnulus.html#sec:examAnnulus"><i class="fa fa-check"></i><b>9.2</b> Example of use</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="sec-timePlot.html"><a href="sec-timePlot.html"><i class="fa fa-check"></i><b>10</b> Time series plots</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sec-timePlot.html"><a href="sec-timePlot.html#sec:timePlotBack"><i class="fa fa-check"></i><b>10.1</b> Background</a></li>
<li class="chapter" data-level="10.2" data-path="sec-timePlot.html"><a href="sec-timePlot.html#examples-of-time-series-plotting"><i class="fa fa-check"></i><b>10.2</b> Examples of time series plotting</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html"><i class="fa fa-check"></i><b>11</b> Temporal variations</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html#sec:purpose-time-var"><i class="fa fa-check"></i><b>11.1</b> Purpose</a></li>
<li class="chapter" data-level="11.2" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html#applications"><i class="fa fa-check"></i><b>11.2</b> Applications</a></li>
<li class="chapter" data-level="11.3" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html#output"><i class="fa fa-check"></i><b>11.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="sec-timeProp.html"><a href="sec-timeProp.html"><i class="fa fa-check"></i><b>12</b> Time proportion plots</a>
<ul>
<li class="chapter" data-level="12.1" data-path="sec-timeProp.html"><a href="sec-timeProp.html#sec:timePropBack"><i class="fa fa-check"></i><b>12.1</b> Background</a></li>
<li class="chapter" data-level="12.2" data-path="sec-timeProp.html"><a href="sec-timeProp.html#sec:timePropEx"><i class="fa fa-check"></i><b>12.2</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="sec-trendLevel.html"><a href="sec-trendLevel.html"><i class="fa fa-check"></i><b>13</b> Trend heat maps</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sec-trendLevel.html"><a href="sec-trendLevel.html#another-way-of-representing-trends"><i class="fa fa-check"></i><b>13.1</b> Another way of representing trends</a></li>
<li class="chapter" data-level="13.2" data-path="sec-trendLevel.html"><a href="sec-trendLevel.html#sec:TrendLevelEx"><i class="fa fa-check"></i><b>13.2</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="sec-calendarPlot.html"><a href="sec-calendarPlot.html"><i class="fa fa-check"></i><b>14</b> Calendar plots</a>
<ul>
<li class="chapter" data-level="14.1" data-path="sec-calendarPlot.html"><a href="sec-calendarPlot.html#purpose"><i class="fa fa-check"></i><b>14.1</b> Purpose</a></li>
<li class="chapter" data-level="14.2" data-path="sec-calendarPlot.html"><a href="sec-calendarPlot.html#calendar-examples"><i class="fa fa-check"></i><b>14.2</b> Calendar examples</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="sec-TheilSen.html"><a href="sec-TheilSen.html"><i class="fa fa-check"></i><b>15</b> Theil-Sen trends</a>
<ul>
<li class="chapter" data-level="15.1" data-path="sec-TheilSen.html"><a href="sec-TheilSen.html#trend-estimates"><i class="fa fa-check"></i><b>15.1</b> Trend estimates</a></li>
<li class="chapter" data-level="15.2" data-path="sec-TheilSen.html"><a href="sec-TheilSen.html#example-trend-analysis"><i class="fa fa-check"></i><b>15.2</b> Example trend analysis</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="sec-TheilSen.html"><a href="sec-TheilSen.html#output-1"><i class="fa fa-check"></i><b>15.2.1</b> Output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="sec-smoothTrend.html"><a href="sec-smoothTrend.html"><i class="fa fa-check"></i><b>16</b> Smooth trends</a>
<ul>
<li class="chapter" data-level="16.1" data-path="sec-smoothTrend.html"><a href="sec-smoothTrend.html#sec:SmoothTrendInfo"><i class="fa fa-check"></i><b>16.1</b> Background</a></li>
<li class="chapter" data-level="16.2" data-path="sec-smoothTrend.html"><a href="sec-smoothTrend.html#examples-of-trend-analysis"><i class="fa fa-check"></i><b>16.2</b> Examples of trend analysis</a></li>
<li class="chapter" data-level="16.3" data-path="sec-smoothTrend.html"><a href="sec-smoothTrend.html#seasonal-averages"><i class="fa fa-check"></i><b>16.3</b> Seasonal averages</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="sec-scatterPlot.html"><a href="sec-scatterPlot.html"><i class="fa fa-check"></i><b>17</b> Scatter plots</a>
<ul>
<li class="chapter" data-level="17.1" data-path="sec-scatterPlot.html"><a href="sec-scatterPlot.html#sec:ScatterPurpose"><i class="fa fa-check"></i><b>17.1</b> Purpose</a></li>
<li class="chapter" data-level="17.2" data-path="sec-scatterPlot.html"><a href="sec-scatterPlot.html#sec:ScatterEx"><i class="fa fa-check"></i><b>17.2</b> Examples</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="sec-scatterPlot.html"><a href="sec-scatterPlot.html#sec:hexbin"><i class="fa fa-check"></i><b>17.2.1</b> Hexaganol binning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html"><i class="fa fa-check"></i><b>18</b> Trajectory analysis</a>
<ul>
<li class="chapter" data-level="18.1" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#plotting-trajectories"><i class="fa fa-check"></i><b>18.1</b> Plotting trajectories</a></li>
<li class="chapter" data-level="18.2" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#sec:trajLevel"><i class="fa fa-check"></i><b>18.2</b> Trajectory gridded frequencies</a></li>
<li class="chapter" data-level="18.3" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#trajectory-source-contribution-functions"><i class="fa fa-check"></i><b>18.3</b> Trajectory source contribution functions</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#identifying-the-contribution-of-high-concentration-back-trajectories"><i class="fa fa-check"></i><b>18.3.1</b> Identifying the contribution of high concentration back trajectories</a></li>
<li class="chapter" data-level="18.3.2" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#allocating-trajectories-to-different-wind-sectors"><i class="fa fa-check"></i><b>18.3.2</b> Allocating trajectories to different wind sectors</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#potential-source-contribution-function-pscf"><i class="fa fa-check"></i><b>18.4</b> Potential Source Contribution Function (PSCF)</a></li>
<li class="chapter" data-level="18.5" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#concentration-weighted-trajectory-cwt"><i class="fa fa-check"></i><b>18.5</b> Concentration Weighted Trajectory (CWT)</a></li>
<li class="chapter" data-level="18.6" data-path="sec-trajPlot.html"><a href="sec-trajPlot.html#sec:trajCluster"><i class="fa fa-check"></i><b>18.6</b> Trajectory clustering</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="sec-conditionalQuantile.html"><a href="sec-conditionalQuantile.html"><i class="fa fa-check"></i><b>19</b> Conditional quantiles</a>
<ul>
<li class="chapter" data-level="19.1" data-path="sec-conditionalQuantile.html"><a href="sec-conditionalQuantile.html#sec:conditionalQuantileBack"><i class="fa fa-check"></i><b>19.1</b> Background</a></li>
<li class="chapter" data-level="19.2" data-path="sec-conditionalQuantile.html"><a href="sec-conditionalQuantile.html#sec:conditionalEval"><i class="fa fa-check"></i><b>19.2</b> Conditional evaluation</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="sec-modStats.html"><a href="sec-modStats.html"><i class="fa fa-check"></i><b>20</b> Model evaluation</a>
<ul>
<li class="chapter" data-level="20.1" data-path="sec-modStats.html"><a href="sec-modStats.html#sec:ModBack"><i class="fa fa-check"></i><b>20.1</b> Background</a></li>
<li class="chapter" data-level="20.2" data-path="sec-modStats.html"><a href="sec-modStats.html#sec:ModEx"><i class="fa fa-check"></i><b>20.2</b> Example of use</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="sec-TaylorDiagram.html"><a href="sec-TaylorDiagram.html"><i class="fa fa-check"></i><b>21</b> Taylor Diagam</a>
<ul>
<li class="chapter" data-level="21.1" data-path="sec-TaylorDiagram.html"><a href="sec-TaylorDiagram.html#sec:TaylorBack"><i class="fa fa-check"></i><b>21.1</b> Background</a></li>
<li class="chapter" data-level="21.2" data-path="sec-TaylorDiagram.html"><a href="sec-TaylorDiagram.html#examples-of-taylor-diagrams"><i class="fa fa-check"></i><b>21.2</b> Examples of Taylor Diagrams</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="sec-utility.html"><a href="sec-utility.html"><i class="fa fa-check"></i><b>22</b> Utility functions</a>
<ul>
<li class="chapter" data-level="22.1" data-path="sec-utility.html"><a href="sec-utility.html#sec:selectByDate"><i class="fa fa-check"></i><b>22.1</b> Selecting data by date</a></li>
<li class="chapter" data-level="22.2" data-path="sec-utility.html"><a href="sec-utility.html#sec:cutData"><i class="fa fa-check"></i><b>22.2</b> Making intervals — cutData</a></li>
<li class="chapter" data-level="22.3" data-path="sec-utility.html"><a href="sec-utility.html#sec:selectRunning"><i class="fa fa-check"></i><b>22.3</b> Selecting run lengths of values above a threshold — pollution episodes</a></li>
<li class="chapter" data-level="22.4" data-path="sec-utility.html"><a href="sec-utility.html#sec:rollingMean"><i class="fa fa-check"></i><b>22.4</b> Calculating rolling means</a></li>
<li class="chapter" data-level="22.5" data-path="sec-utility.html"><a href="sec-utility.html#sec:timeAverage"><i class="fa fa-check"></i><b>22.5</b> Aggregating data by different time intervals</a></li>
<li class="chapter" data-level="22.6" data-path="sec-utility.html"><a href="sec-utility.html#sec:calcPercentile"><i class="fa fa-check"></i><b>22.6</b> Calculating percentiles</a></li>
<li class="chapter" data-level="22.7" data-path="sec-utility.html"><a href="sec-utility.html#sec:corPlot"><i class="fa fa-check"></i><b>22.7</b> Correlation matrices</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html"><i class="fa fa-check"></i><b>A</b> Annotating openair plots</a>
<ul>
<li class="chapter" data-level="A.1" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#adding-text"><i class="fa fa-check"></i><b>A.1</b> Adding text</a></li>
<li class="chapter" data-level="A.2" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#adding-text-and-a-shaded-area"><i class="fa fa-check"></i><b>A.2</b> Adding text and a shaded area</a></li>
<li class="chapter" data-level="A.3" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#adding-an-arrow"><i class="fa fa-check"></i><b>A.3</b> Adding an arrow</a></li>
<li class="chapter" data-level="A.4" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#adding-a-reference-line-and-text"><i class="fa fa-check"></i><b>A.4</b> Adding a reference line and text</a></li>
<li class="chapter" data-level="A.5" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#highlight-a-specific-point"><i class="fa fa-check"></i><b>A.5</b> Highlight a specific point</a></li>
<li class="chapter" data-level="A.6" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#add-a-filled-polygon"><i class="fa fa-check"></i><b>A.6</b> Add a filled polygon</a></li>
<li class="chapter" data-level="A.7" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#add-air-quality-bands-as-polygons"><i class="fa fa-check"></i><b>A.7</b> Add air quality bands as polygons</a></li>
<li class="chapter" data-level="A.8" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#polar-plot-examples-1"><i class="fa fa-check"></i><b>A.8</b> Polar plot examples</a></li>
<li class="chapter" data-level="A.9" data-path="annotating-openair-plots.html"><a href="annotating-openair-plots.html#using-grid-graphics-identify-locations-interactively"><i class="fa fa-check"></i><b>A.9</b> Using grid graphics — identify locations interactively</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="sec-prod-hyspl-traj.html"><a href="sec-prod-hyspl-traj.html"><i class="fa fa-check"></i><b>B</b> Production of HYSPLIT trajectory files</a></li>
<li class="chapter" data-level="C" data-path="sec-trends-gam.html"><a href="sec-trends-gam.html"><i class="fa fa-check"></i><b>C</b> A closer look at trends</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The openair book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec:trends-gam" class="section level1" number="25">
<h1><span class="header-section-number">C</span> A closer look at trends</h1>
<p>Understanding trends is a core component of air quality and the
atmospheric sciences in general. <span class="pkg">openair</span> provides two main functions
for considering trends (<code>smoothTrend</code> and <code>TheilSen</code>; see Sections <a href="sec-smoothTrend.html#sec:smoothTrend">16</a> and <a href="sec-TheilSen.html#sec:TheilSen">15</a>), the
latter useful for linear trend estimates. Understanding trends and
quantifying them robustly is not so easy and careful analysis would
treat each time series individually and consider a wide range of
diagnostics. In this section we take advantage of some of the
excellent capabilities that R has to consider fitting trend
models. Experience with real atmospheric composition data shows that
trends are rarely linear, which is unfortunate given how much of
statistics has been built around the linear model.</p>
<p>Generalized Additive Models (GAMs) offer a flexible approach to
calculating trends and in particular, the <span class="pkg">mgcv</span> package contains
many functions that are very useful for such modelling. Some of the
details of this type of model are presented in <span class="citation"><a href="references.html#ref-Wood2006" role="doc-biblioref">Wood</a> (<a href="references.html#ref-Wood2006" role="doc-biblioref">2006</a>)</span> and
the <span class="pkg">mgcv</span> package itself.</p>
<p>The example considered is 23 years of O<sub>3</sub> measurements at Mace Head
on the West coast of Ireland. The example shows the sorts of steps
that might be taken to build a model to explain the trend. The data
are first imported and then the year, month and <code>trend' estimated. Note that</code>trend’ here is simply a decimal date that can be
used to construct various explanatory models.</p>
<p>First we import the data:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="sec-trends-gam.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb331-2"><a href="sec-trends-gam.html#cb331-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">importAURN</span>(<span class="at">site =</span> <span class="st">&quot;mh&quot;</span>, <span class="at">year =</span> <span class="dv">1988</span><span class="sc">:</span><span class="dv">2010</span>)</span></code></pre></div>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="sec-trends-gam.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate monthly means</span></span>
<span id="cb332-2"><a href="sec-trends-gam.html#cb332-2" aria-hidden="true" tabindex="-1"></a>monthly <span class="ot">&lt;-</span> <span class="fu">timeAverage</span>(dat, <span class="at">avg.time =</span> <span class="st">&quot;month&quot;</span>)</span>
<span id="cb332-3"><a href="sec-trends-gam.html#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="do">## now calculate components for the models</span></span>
<span id="cb332-4"><a href="sec-trends-gam.html#cb332-4" aria-hidden="true" tabindex="-1"></a>monthly<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(monthly<span class="sc">$</span>date, <span class="st">&quot;%Y&quot;</span>))</span>
<span id="cb332-5"><a href="sec-trends-gam.html#cb332-5" aria-hidden="true" tabindex="-1"></a>monthly<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(monthly<span class="sc">$</span>date, <span class="st">&quot;%m&quot;</span>))</span>
<span id="cb332-6"><a href="sec-trends-gam.html#cb332-6" aria-hidden="true" tabindex="-1"></a>monthly <span class="ot">&lt;-</span> <span class="fu">transform</span>(monthly, <span class="at">trend =</span> year <span class="sc">+</span> (month <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">12</span>)</span></code></pre></div>
<p>It is <em>always</em> a good idea to plot the data first:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="sec-trends-gam.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">timePlot</span>(monthly, <span class="at">pollutant =</span> <span class="st">&quot;o3&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:MHplot"></span>
<img src="openair_files/figure-html/MHplot-1.png" alt="Monthly mean O~3~ concentrations at Mace Head, Ireland (1998--2010)." width="960" />
<p class="caption">
Figure C.1: Monthly mean O<sub>3</sub> concentrations at Mace Head, Ireland (1998–2010).
</p>
</div>
<p>Figure <a href="sec-trends-gam.html#fig:MHplot">C.1</a> shows that there is a clear seasonal variation in
O<sub>3</sub> concentrations, which is certainly expected. Less obvious is
whether there is a trend.</p>
<p>Even though it is known there is a seasonal signal in the data, we
will first of all ignore it and build a simple model that only has a trend component (model M0).</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="sec-trends-gam.html#cb334-1" aria-hidden="true" tabindex="-1"></a>M0 <span class="ot">&lt;-</span> <span class="fu">gam</span>(o3 <span class="sc">~</span> <span class="fu">s</span>(trend), <span class="at">data =</span> monthly)</span>
<span id="cb334-2"><a href="sec-trends-gam.html#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M0)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## o3 ~ s(trend)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  71.3428     0.6198   115.1   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##          edf Ref.df     F p-value   
## s(trend)   1      1 6.958 0.00881 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.0212   Deviance explained = 2.48%
## GCV = 106.82  Scale est. = 106.04    n = 276</code></pre>
<p>This model only explains about 2% of the variation as shown by the
adjusted r<sup>2</sup>. More of a problem however is that no account has been
taken of the seasonal variation. An easy way of seeing the effect of
this omission is to plot the autocorrelation function (ACF) of the
residuals, shown in Figure <a href="sec-trends-gam.html#fig:M0ACF">C.2</a>. This Figure clearly shows the
residuals have a strong seasonal pattern. <span class="citation"><a href="references.html#ref-Chatfield2004" role="doc-biblioref">Chatfield</a> (<a href="references.html#ref-Chatfield2004" role="doc-biblioref">2004</a>)</span>
provides lots of useful information on time series modelling.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="sec-trends-gam.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">residuals</span>(M0))</span></code></pre></div>
<div class="figure"><span id="fig:M0ACF"></span>
<img src="openair_files/figure-html/M0ACF-1.png" alt="ACF for the residuals of model M0." width="50%" />
<p class="caption">
Figure C.2: ACF for the residuals of model M0.
</p>
</div>
<p>A refined model should therefore take account of the seasonal variation
in O<sub>3</sub> concentrations. Therefore, we add a term taking account of
the seasonal variation. Note also that we choose a cyclic spline for
the monthly component (<code>bs = "cc"</code>), which joins the first and last
points i.e. January and December.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="sec-trends-gam.html#cb337-1" aria-hidden="true" tabindex="-1"></a>M1 <span class="ot">&lt;-</span> <span class="fu">gam</span>(o3 <span class="sc">~</span> <span class="fu">s</span>(trend) <span class="sc">+</span> <span class="fu">s</span>(month, <span class="at">bs =</span> <span class="st">&quot;cc&quot;</span>), <span class="at">data =</span> monthly)</span>
<span id="cb337-2"><a href="sec-trends-gam.html#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M1)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## o3 ~ s(trend) + s(month, bs = &quot;cc&quot;)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  71.3428     0.3738   190.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df     F p-value    
## s(trend) 1.218  1.404 15.78 1.1e-05 ***
## s(month) 6.111  8.000 59.35 &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.644   Deviance explained = 65.4%
## GCV = 39.766  Scale est. = 38.566    n = 276</code></pre>
<p>Now we have a model that explains much more of the variation with an
r<sup>2</sup> of 0.65. Also, the p-values for the trend and seasonal
components are both highly statistically significant. Let’s have a look
at the separate components for trend and seasonal variation:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="sec-trends-gam.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.gam</span>(M1, <span class="at">select =</span> <span class="dv">1</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:M1trend"></span>
<img src="openair_files/figure-html/M1trend-1.png" alt="The trend component of model M1." width="50%" />
<p class="caption">
Figure C.3: The trend component of model M1.
</p>
</div>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="sec-trends-gam.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.gam</span>(M1, <span class="at">select =</span> <span class="dv">2</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:M1seas"></span>
<img src="openair_files/figure-html/M1seas-1.png" alt="The seasonal component of model M1." width="50%" />
<p class="caption">
Figure C.4: The seasonal component of model M1.
</p>
</div>
<p>The seasonal component shown in Figure <a href="sec-trends-gam.html#fig:M1seas">C.4</a> clearly shows the
strong seasonal effect on O<sub>3</sub> at this site (peaking in April). The
trend component is actually linear in this case and could be modelled
as such. This model looks much better, but as is often the case
autocorrelation could remain important. The ACF is shown in Figure
<a href="sec-trends-gam.html#fig:M1ACF">C.5</a> and shows there is still some short-term
correlation in the residuals.</p>
<p>Note also that there are other diagnostic tests one should consider
when comparing these models that are not shown here e.g. such as
considering the normality of the residuals. Indeed a consideration of
the residuals shows that the model fails to some extent in explaining
the very low values of O<sub>3</sub>, which can be seen in
Figure <a href="sec-trends-gam.html#fig:MHplot">C.1</a>. These few points (which skew the residuals) may
well be associated with air masses from the polluted regions of
Europe. Better and more useful models would likely be possible if the
data were split my airmass origin, which is something that will be
returned to when <span class="pkg">openair</span> includes a consideration of back
trajectories.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="sec-trends-gam.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">residuals</span>(M1))</span></code></pre></div>
<div class="figure"><span id="fig:M1ACF"></span>
<img src="openair_files/figure-html/M1ACF-1.png" alt="ACF for the residuals of model M1." width="50%" />
<p class="caption">
Figure C.5: ACF for the residuals of model M1.
</p>
</div>
<p>Further tests, also considering the partial autocorrelation function
(PACF) suggest that an AR1 model is suitable for modelling this
short-term autocorrelation. This is where modelling using a GAMM
(Generalized Additive Mixed Model) comes in because it is possible to
model the short-term autocorrelation using a linear mixed model. The
<code>gamm</code> function uses the package <span class="pkg">nmle</span> and the Generalized
Linear Mixed Model (GLMM) fitting routine. In the M2 model below the
correlation structure is considered explicitly.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="sec-trends-gam.html#cb342-1" aria-hidden="true" tabindex="-1"></a>M2 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(o3 <span class="sc">~</span> <span class="fu">s</span>(month, <span class="at">bs =</span> <span class="st">&quot;cc&quot;</span>)  <span class="sc">+</span> <span class="fu">s</span>(trend), </span>
<span id="cb342-2"><a href="sec-trends-gam.html#cb342-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> monthly,</span>
<span id="cb342-3"><a href="sec-trends-gam.html#cb342-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> month <span class="sc">|</span> year))</span>
<span id="cb342-4"><a href="sec-trends-gam.html#cb342-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M2<span class="sc">$</span>gam)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## o3 ~ s(month, bs = &quot;cc&quot;) + s(trend)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  71.3163     0.4933   144.6   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##            edf Ref.df     F p-value    
## s(month) 6.915      8 42.18 &lt; 2e-16 ***
## s(trend) 1.000      1 15.07 0.00013 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.643   
##   Scale est. = 38.863    n = 276</code></pre>
<p>The ACF plot is shown in Figure <a href="sec-trends-gam.html#fig:M2ACF">C.6</a> and shows that the
autocorrelation has been dealt with and we can be rather more
confident about the trend component (not plotted). Note that in this
case we need to use the normalized residuals to get residuals that
take account of the fitted correlation structure.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="sec-trends-gam.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(<span class="fu">residuals</span>(M2<span class="sc">$</span>lme, <span class="at">type =</span> <span class="st">&quot;normalized&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:M2ACF"></span>
<img src="openair_files/figure-html/M2ACF-1.png" alt="ACF for the residuals of model M2." width="50%" />
<p class="caption">
Figure C.6: ACF for the residuals of model M2.
</p>
</div>
<p>Note that model M2 assumes that the trend and seasonal terms vary
independently of one another. However, if the seasonal amplitude
and/or phase change over time then a model that accounts for the
interaction between the two may be better. Indeed, this does seem to
be the case here, as shown by the improved fit of the model
below. This model uses a tensor product smooth (<code>te</code>) and the
reason for doing this and not using an isotropic smooth (<code>s</code>) is
that the trend and seasonal components are essentially on different
scales. We would not necessarily want to apply the same level of
smoothness to both components. An example of covariates on the same
scale would be latitude and longitude.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="sec-trends-gam.html#cb345-1" aria-hidden="true" tabindex="-1"></a>M3 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(o3 <span class="sc">~</span> <span class="fu">s</span>(month, <span class="at">bs =</span> <span class="st">&quot;cc&quot;</span>)  <span class="sc">+</span> </span>
<span id="cb345-2"><a href="sec-trends-gam.html#cb345-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">te</span>(trend, month), <span class="at">data =</span> monthly,</span>
<span id="cb345-3"><a href="sec-trends-gam.html#cb345-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> month <span class="sc">|</span> year))</span>
<span id="cb345-4"><a href="sec-trends-gam.html#cb345-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M3<span class="sc">$</span>gam)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## o3 ~ s(month, bs = &quot;cc&quot;) + te(trend, month)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  71.3213     0.4582   155.7   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                   edf Ref.df      F  p-value    
## s(month)        6.886  8.000 22.200  &lt; 2e-16 ***
## te(trend,month) 4.164  4.164  7.961 8.08e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.667   
##   Scale est. = 36.121    n = 276</code></pre>
<p>It becomes a bit more difficult to plot the two-way interaction
between the trend and the month, but it is possible with a surface as
shown in Figure <a href="sec-trends-gam.html#fig:perpsM3">C.7</a>. This plot shows for example that
during summertime the trends component varies little. However for the
autumn and winter months there has been a much greater increase in the
trend component for O<sub>3</sub>.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="sec-trends-gam.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(M3<span class="sc">$</span>gam, <span class="at">select =</span> <span class="dv">2</span>, <span class="at">pers =</span> <span class="cn">TRUE</span>, <span class="at">theta =</span> <span class="dv">225</span>, <span class="at">phi =</span> <span class="dv">10</span>,<span class="at">ticktype =</span> <span class="st">&quot;detailed&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:perpsM3"></span>
<img src="openair_files/figure-html/perpsM3-1.png" alt="lot showing the two-way interaction between the trend and seasonal components." width="55%" />
<p class="caption">
Figure C.7: lot showing the two-way interaction between the trend and seasonal components.
</p>
</div>
<p>While there have been many steps involved in this short analysis, the
data at Mace Head are not typical of most air quality data observed,
say in urban areas. Much of the data considered in these areas does
not appear to have significant autocorrelation in the residuals once
the seasonal variation has been accounted for, therefore avoiding the
complexities of taking account of the correlation structure of the
data. It may be for example that sites like Mace Head and a pollutant
such as O<sub>3</sub> are much more prone to larger scale atmospheric
processes that are not captured by these models.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-prod-hyspl-traj.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/davidcarslaw/openair-book/edit/master/appendix-trends.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
