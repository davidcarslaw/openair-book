<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>2&nbsp; The openair package – The openair book</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../sections/data-access/UK-air-quality-data.html" rel="next">
<link href="../../sections/intro/intro.html" rel="prev">
<link href="../../favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-1fb2157d75a233bbd51d4804bd13b65d.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6f1668ce94382950e705e780c49fb9e5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../style.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../sections/intro/openair-package.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The openair package</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/plume.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">The openair book</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/davidcarslaw/openair-book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/intro/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/intro/openair-package.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The openair package</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Access</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/data-access/UK-air-quality-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Accessing UK Air Quality Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/data-access/access-met-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Access meteorological data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Directional Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/directional-analysis/wind-roses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Wind and Pollution Roses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/directional-analysis/polar-freq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Polar frequencies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/directional-analysis/percentile-roses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Percentile roses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/directional-analysis/polar-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Polar plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/directional-analysis/polar-annulus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Polar annulus</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/directional-analysis/trajectory-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Trajectory analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Time Series and Trends</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/time-plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time series plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/time-variation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Temporal variations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/calendar-plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Calendar plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/time-proportion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Time proportion plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/theil-sen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Theil-Sen trends</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/smooth-trend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Smooth trends</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/run-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Dilution lines and pollutant ratios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/trend-analysis/trend-level.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Trend heat maps</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Model Evaluation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/model-evaluation/mod-stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Model evaluation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/model-evaluation/taylor-diagram.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Taylor Diagam</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/model-evaluation/conditional-quantiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Conditional quantiles</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Interactive Maps</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/maps/maps-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">openairmaps primer</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/maps/maps-network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Network Visualisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/maps/maps-polar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Directional Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/maps/maps-traj.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Trajectory Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Utility functions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/utilities/utility-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Utility functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/utilities/scatter-plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Scatter plots</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/appendices/appendix-annotate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Annotating openair plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/appendices/appendix-hysplit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Production of HYSPLIT trajectory files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/appendices/appendix-trends.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">A closer look at trends</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../sections/appendices/appendix-gethelp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Getting help</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#installation-and-code-access" id="toc-installation-and-code-access" class="nav-link active" data-scroll-target="#installation-and-code-access"><span class="header-section-number">2.1</span> Installation and code access</a></li>
  <li><a href="#input-data-requirements" id="toc-input-data-requirements" class="nav-link" data-scroll-target="#input-data-requirements"><span class="header-section-number">2.2</span> Input data requirements</a></li>
  <li><a href="#reading-and-formatting-dates-and-times" id="toc-reading-and-formatting-dates-and-times" class="nav-link" data-scroll-target="#reading-and-formatting-dates-and-times"><span class="header-section-number">2.3</span> Reading and formatting dates and times</a></li>
  <li><a href="#brief-intr-open" id="toc-brief-intr-open" class="nav-link" data-scroll-target="#brief-intr-open"><span class="header-section-number">2.4</span> Brief overview of openair</a></li>
  <li>
<a href="#the-type-option" id="toc-the-type-option" class="nav-link" data-scroll-target="#the-type-option"><span class="header-section-number">2.5</span> The type option</a>
  <ul class="collapse">
<li><a href="#make-your-own-type" id="toc-make-your-own-type" class="nav-link" data-scroll-target="#make-your-own-type"><span class="header-section-number">2.5.1</span> Make your own type</a></li>
  </ul>
</li>
  <li><a href="#font-size" id="toc-font-size" class="nav-link" data-scroll-target="#font-size"><span class="header-section-number">2.6</span> Controlling font size</a></li>
  <li><a href="#colours" id="toc-colours" class="nav-link" data-scroll-target="#colours"><span class="header-section-number">2.7</span> Using colours</a></li>
  <li><a href="#quickText" id="toc-quickText" class="nav-link" data-scroll-target="#quickText"><span class="header-section-number">2.8</span> Automatic text formatting</a></li>
  <li><a href="#sec-multiple-plots-page" id="toc-sec-multiple-plots-page" class="nav-link" data-scroll-target="#sec-multiple-plots-page"><span class="header-section-number">2.9</span> Multiple plots on a page</a></li>
  <li><a href="#saving-plots-and-data" id="toc-saving-plots-and-data" class="nav-link" data-scroll-target="#saving-plots-and-data"><span class="header-section-number">2.10</span> Saving plots and data</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/davidcarslaw/openair-book/edit/master/sections/intro/openair-package.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="openair-package" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The openair package</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>In this book two packages are frequently used and it is a good idea to load both.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openair/">openair</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>Because the <span class="pkg">openair</span> package (and R itself) are continually updated, it will be useful to know this document was produced using R version 4.3.3 and <span class="pkg">openair</span> version 2.18.2.9004.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Function help
</div>
</div>
<div class="callout-body-container callout-body">
<p>Where code is shown in this document, function names are hyper-linked and will take you to the help page for the function.</p>
</div>
</div>
<section id="installation-and-code-access" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="installation-and-code-access">
<span class="header-section-number">2.1</span> Installation and code access</h2>
<p><span class="pkg">openair</span> is avaiable on <a href="https://cran.r-project.org/mirrors.html">CRAN</a> (Comprehensive R Archive network) which means it can be installed easily from R. I would recommend re-starting R and then type <code>install.packages("openair")</code>. If you use <a href="https://rstudio.com/products/rstudio/">RStudio</a> (which is <em>highly</em> recommended), you can just choose the ‘packages’ tab on the bottom-right, and then select ‘Install’. Simply start typing openair and you will find the package.</p>
<p>For <span class="pkg">openair</span> all development is carried out using Github for version control. Users can access all code used in openair at (<a href="https://github.com/davidcarslaw/openair" class="uri">https://github.com/davidcarslaw/openair</a>).</p>
<p>Sometimes it might be useful to install the development version of <span class="pkg">openair</span> and you can find instructions <a href="https://github.com/davidcarslaw/openair">here</a>.</p>
</section><section id="input-data-requirements" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="input-data-requirements">
<span class="header-section-number">2.2</span> Input data requirements</h2>
<p>The <span class="pkg">openair</span> package applies certain constraints on input data requirements. <strong>It is important to adhere to these requirements to ensure that data are correctly formatted for use in</strong> <span class="pkg">openair</span>. The principal reason for insisting on specific input data format is that there will be less that can go wrong and it is easier to write code for a more limited set of conditions.</p>
<ul>
<li><p>Data should be in a data frame (or <code>tibble</code>).</p></li>
<li><p><strong>The date/time field should be called <code>date</code></strong> — note the lower case. No other name is acceptable.</p></li>
<li><p><strong>The wind speed and wind direction should be named <code>ws</code> and <code>wd</code></strong>, respectively (note again, lower case). Wind directions follow the UK Met Office format and are represented as degrees from north e.g.&nbsp;90 degrees is east. North is taken to be 360 degrees</p></li>
<li><p>Where fields should have numeric data e.g.&nbsp;concentrations of NO<sub>x</sub>, then the user should ensure that no other characters are present in the column, accept maybe something that represents missing data e.g.&nbsp;‘no data’.</p></li>
<li><p>Other variables names can be upper/lower case <em>but should not start with a number</em>. If column names do have white spaces, R will automatically replace them with a full-stop. While <code>PM2.5</code> as a field name is perfectly acceptable, it is a pain to type it in—better just to use <code>pm25</code> (<span class="pkg">openair</span> will recognise pollutant names like this and automatically format them as PM<sub>2.5</sub> in plots).</p></li>
</ul></section><section id="reading-and-formatting-dates-and-times" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="reading-and-formatting-dates-and-times">
<span class="header-section-number">2.3</span> Reading and formatting dates and times</h2>
<p>While not specific to <span class="pkg">openair</span>, dealing with dates and times is likely to be an issue that needs to be dealt with at some point. There is no getting away from the fact that dates and times can be complicated with issues such as time zones and daylight saving time i.e.&nbsp;when the clocks change for summer. This is a potentially big topic to consider and it is only considered in outline here.</p>
<p>For a lot of <span class="pkg">openair</span> functions this issue will not be important. While these issues can often be ignored, it is better to be explicit and set the date-time correctly. Two situations where it becomes important is when wanting to show temporal variations in local time and combining data sets that are in different time zones. The former issue can be important (for example) when considering diurnal variations in a pollutant concentration that follows a human activity (such as rush-hour traffic), which follows local time and not GMT/UTC.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Know your data!
</div>
</div>
<div class="callout-body-container callout-body">
<p>When importing data into R it is important to know how the date-time is represented in your original data, especially in terms of time zone.</p>
</div>
</div>
<p>When importing data it is important to know how the date-time is represented. In the UK it is easy for us to forget that simply working with data in GMT is not always an option. However, most air quality and meteorological data around the world tends to be in GMT/UTC or a fixed offset from GMT/UTC i.e.&nbsp;not in local time where hours can be missing or duplicated.</p>
<p>Life is made much easier using the <span class="pkg">lubridate</span> package, which has been developed for working with dates and times. The <span class="pkg">lubridate</span> package has a family of functions that will convert common formats of dates and times into a R-formatted version. These functions are useful when importing data and the date-time is in a character format and needs formatting. Here are some examples:</p>
<p>Original date in ‘British’ format (day/month/ year hours-minutes):</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span> <span class="co"># load package</span></span>
<span><span class="va">date_time</span> <span class="op">&lt;-</span> <span class="st">"2/8/2022 11:00"</span></span>
<span></span>
<span><span class="co"># format it</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">dmy_hm</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-02 11:00:00 UTC"</code></pre>
</div>
</div>
<p>When R formats a date-time correctly is will be shown from ‘large to small’ i.e.&nbsp;YYYY-MM-DD HH:MM:SS, which provides a clue that it has indeed been formatted correctly.</p>
<p>US date time with seconds (month-day-year):</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="va">date_time</span> <span class="op">&lt;-</span> <span class="st">"8/2/2022 11:05:12"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hms</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-02 11:05:12 UTC"</code></pre>
</div>
</div>
<p>As you can see, by default, the date-time is formatted in UTC (GMT). It is at this point where you can also set a time zone of the original data if it was not in GMT. Let’s assume the original data were a fixed off-set from GMT of -8 hours (west coast USA perhaps). This can be done by setting the time zone explicitly<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="va">date_time</span> <span class="op">&lt;-</span> <span class="st">"8/2/2022 11:05:12"</span> <span class="co"># time 8 hours behind GMT</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hms</a></span><span class="op">(</span><span class="va">date_time</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT+8"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-02 11:05:12 -08"</code></pre>
</div>
</div>
<p>which actually shows the GMT offset of -8 hours.</p>
<p>A common task might be to plot time series and temporal variations of pollutant concentrations in local time. How does one do this if the imported data are in GMT/UTC (or a fixed offset from GMT/UTC)?</p>
<p>In this case it is necessary to know how the local time zone with daylight saving time (DST) is represented. Time zone names follow the Olson scheme — you can list them by typing <code><a href="https://rdrr.io/r/base/timezones.html">OlsonNames()</a></code>. Given the scenario where we have imported data in GMT but want to display the data in local time (BST — British Summer Time), we can use the <code>with_tz</code> function in <span class="pkg">lubridate</span> to do this:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="va">date_time</span> <span class="op">&lt;-</span> <span class="st">"2/8/2022 11:00"</span></span>
<span></span>
<span><span class="co"># format it</span></span>
<span><span class="va">date_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">dmy_hm</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span> <span class="co"># GMT</span></span>
<span><span class="va">date_time</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-02 11:00:00 UTC"</code></pre>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="co"># what is the hour?</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="co"># format in local time</span></span>
<span><span class="va">time_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">date_time</span>, tz <span class="op">=</span> <span class="st">"Europe/London"</span><span class="op">)</span></span>
<span><span class="va">time_local</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-02 12:00:00 BST"</code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="co"># local hour is +1 from GMT</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">time_local</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
</div>
<p>In the above example, <code>date_time</code> and <code>time_local</code> are the same absolute time — we are just changing how the time is displayed. In practice, given a data frame with a <code>date</code> column in GMT and there interest in making sure <span class="pkg">openair</span> uses the local time, some formatting such as <code>mydata$date -&gt; with_tz(mydata$date, tz = "Europe/London")</code> is what is needed.</p>
<p>Another scenario is you import data using a function such as <code>read_csv</code> from the <span class="pkg">readr</span> package and it recognises a date-time in the data and by default assumes it is GMT/UTC. This might be wrong even though it is now formatted correctly in R. In this case you can <em>force</em> a new time zone using the <code>force_tz</code> function. For example:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="co"># a correctly formatted date-time that is in GMT but should be something else</span></span>
<span><span class="va">date_time</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-02 11:00:00 UTC"</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="co"># force the time zone to be something different</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/force_tz.html">force_tz</a></span><span class="op">(</span><span class="va">date_time</span>, tz <span class="op">=</span> <span class="st">"Etc/GMT+8"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-02 11:00:00 -08"</code></pre>
</div>
</div>
<p>Finally, what about combining data sets in different time zones? In <a href="../data-access/access-met-data.html" class="quarto-xref"><span>Chapter 4</span></a> it is shown how it is possible to access meteorological data from around the world (all in GMT). The interest might be in combining this data with air quality data that is in another time zone. So long as the date-times were correctly formatted in the first place, then simply joining the data sets by date is all that is needed, as R works out how the times match internally. An example of joining two data sets is shown in <a href="../data-access/access-met-data.html#sec-link-aq" class="quarto-xref"><span>Section 4.2</span></a>.</p>
</section><section id="brief-intr-open" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="brief-intr-open">
<span class="header-section-number">2.4</span> Brief overview of openair</h2>
<p>This section gives a brief overview of the functions in <span class="pkg">openair</span>. Having read some data into a data frame it is then straightforward to run any function. Almost all functions are run as:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="fu">functionName</span><span class="op">(</span><span class="va">thedata</span>, <span class="va">options</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The usage is best illustrated through a specific example, in this case the <code>polarPlot</code> function. The details of the function are shown in <a href="../directional-analysis/polar-plots.html" class="quarto-xref"><span>Chapter 8</span></a> and through the help pages (type ?polarPlot). As it can be seen there are numerous options associated with <code>polarPlot</code> — and most other functions and each of these has a default. For example, the default pollutant considered in <code>polarPlot</code> is <code>nox</code>. If the user has a data frame called <code>theData</code> then <code>polarPlot</code> could minimally be called by:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">theData</span><span class="op">)</span></span></code></pre></div>
</div>
<p>which would plot a <code>nox</code> polar plot if <code>nox</code> was available in the data frame <code>theData</code>.</p>
<p>Note that the options do not need to be specified in order nor is it always necessary to write the whole word. For example, it is possible to write:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">theData</span>, type <span class="op">=</span> <span class="st">"year"</span>, poll <span class="op">=</span> <span class="st">"so2"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>In this case writing <code>poll</code> is sufficient to uniquely identify that the option is <code>pollutant</code>.</p>
<p>Also there are many common options available in functions that are not explicitly documented, but are part of lattice graphics. Some common ones are summarised in <a href="#tbl-options" class="quarto-xref">Table&nbsp;<span>2.1</span></a>. The <code>layout</code> option allows the user to control the layout of multi-panel plots e.g.&nbsp;<code>layout = c(4, 1)</code> would ensure a four-panel plot is 4 columns by 1 row.</p>
<div class="cell">
<div id="tbl-options" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-options-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: Common options used in <span class="pkg">openair</span> plots that can be set by the user but are generally not explicitly documented.
</figcaption><div aria-describedby="tbl-options-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">option</th>
<th style="text-align: left;">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">xlab</td>
<td style="text-align: left;">x-axis label</td>
</tr>
<tr class="even">
<td style="text-align: left;">ylab</td>
<td style="text-align: left;">y-axis label</td>
</tr>
<tr class="odd">
<td style="text-align: left;">main</td>
<td style="text-align: left;">title of the plot</td>
</tr>
<tr class="even">
<td style="text-align: left;">pch</td>
<td style="text-align: left;">plotting symbol used for points</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cex</td>
<td style="text-align: left;">size of symbol plotted</td>
</tr>
<tr class="even">
<td style="text-align: left;">lty</td>
<td style="text-align: left;">line type</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lwd</td>
<td style="text-align: left;">line width</td>
</tr>
<tr class="even">
<td style="text-align: left;">layout</td>
<td style="text-align: left;">the plot layout e.g.&nbsp;c(2, 2)</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section id="the-type-option" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="the-type-option">
<span class="header-section-number">2.5</span> The type option</h2>
<p>One of the central themes in <span class="pkg">openair</span> is the idea of <em>conditioning</em>. Rather than plot <span class="math inline">\(x\)</span> against <span class="math inline">\(y\)</span>, considerably more information can usually be gained by considering a third variable, <span class="math inline">\(z\)</span>. In this case, <span class="math inline">\(x\)</span> is plotted against <span class="math inline">\(y\)</span> for many different intervals of <span class="math inline">\(z\)</span>. This idea can be further extended. For example, a trend of NO<sub>x</sub> against time can be <em>conditioned</em> in many ways: NO<sub>x</sub> vs.&nbsp;time split by wind sector, day of the week, wind speed, temperature, hour of the day … and so on. This type of analysis is rarely carried out when analysing air pollution data, in part because it is time consuming to do. However, thanks to the capabilities of R and packages such as <span class="pkg">lattice</span> and <span class="pkg">ggplot2</span>, it becomes easier to work in this way.</p>
<p>In most <span class="pkg">openair</span> functions conditioning is controlled using the <code>type</code> option. <code>type</code> can be any other variable available in a data frame (numeric, character or factor). A simple example of <code>type</code> would be a variable representing a ‘before’ and ‘after’ situation, say a variable called <code>period</code> i.e.&nbsp;the option <code>type = "period"</code> is supplied. In this case a plot or analysis would be separately shown for ‘before’ and ‘after’. When <code>type</code> is a numeric variable then the data will be split into four <em>quantiles</em> and labelled accordingly. Note however the user can set the quantile intervals to other values using the option <code>n.levels</code>. For example, the user could choose to plot a variable by different levels of temperature. If <code>n.levels = 3</code> then the data could be split by ‘low’, ‘medium’ and ‘high’ temperatures, and so on. Some variables are treated in a special way. For example if <code>type = "wd"</code> then the data are split into 8 wind sectors (N, NE, E, …) and plots are organised by points of the compass.</p>
<p>There are a series of pre-defined values that <code>type</code> can take related to the temporal components of the data as summarised in <a href="#tbl-openairType" class="quarto-xref">Table&nbsp;<span>2.2</span></a>. To use these there <em>must</em> be a <code>date</code> field so that it can be calculated. These pre-defined values of <code>type</code> are shown below are both useful and convenient. Given a data frame containing several years of data it is easy to analyse the data e.g.&nbsp;plot it, by year by supplying the option <code>type = "year"</code>. Other useful and straightforward values are “hour” and “month”. When <code>type = "season"</code> <span class="pkg">openair</span> will split the data by the four seasons (winter = Dec/Jan/Feb etc.). Note for southern hemisphere users that the option <code>hemisphere = "southern"</code> can be given. When <code>type = "daylight"</code> is used the data are split between nighttime and daylight hours. In this case the user can also supply the options <code>latitude</code> and <code>longitude</code> for their location (the default is London).</p>
<div class="cell">
<div id="tbl-openairType" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-openairType-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.2: Built-in ways of splitting data in <span class="pkg">openair</span> using the <code>type</code> option that is available for most functions.
</figcaption><div aria-describedby="tbl-openairType-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 96%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">option</th>
<th style="text-align: left;">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">‘year’</td>
<td style="text-align: left;">splits data by year</td>
</tr>
<tr class="even">
<td style="text-align: left;">‘month’</td>
<td style="text-align: left;">splits data by month of the year</td>
</tr>
<tr class="odd">
<td style="text-align: left;">‘week’</td>
<td style="text-align: left;">splits data by week of the year</td>
</tr>
<tr class="even">
<td style="text-align: left;">‘monthyear’</td>
<td style="text-align: left;">splits data by year <em>and</em> month</td>
</tr>
<tr class="odd">
<td style="text-align: left;">‘season’</td>
<td style="text-align: left;">splits data by season. Note in this case the user can also supply a <code>hemisphere</code> option that can be either ‘northern’ (default) or ‘southern’</td>
</tr>
<tr class="even">
<td style="text-align: left;">‘weekday’</td>
<td style="text-align: left;">splits data by day of the week</td>
</tr>
<tr class="odd">
<td style="text-align: left;">‘weekend’</td>
<td style="text-align: left;">splits data by Saturday, Sunday, weekday</td>
</tr>
<tr class="even">
<td style="text-align: left;">‘daylight’</td>
<td style="text-align: left;">splits data by nighttime/daytime. Note the user must supply a <code>longitude</code> and <code>latitude</code>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;">‘dst’</td>
<td style="text-align: left;">splits data by daylight saving time and non-daylight saving time</td>
</tr>
<tr class="even">
<td style="text-align: left;">‘wd’</td>
<td style="text-align: left;">if wind direction (<code>wd</code>) is available <code>type = 'wd'</code> will split the data into 8 sectors: N, NE, E, SE, S, SW, W, NW</td>
</tr>
<tr class="odd">
<td style="text-align: left;">‘seasonyear’</td>
<td style="text-align: left;">will split the data into year-season intervals, keeping the months of a season together. For example, December 2010 is considered as part of winter 2011 (with January and February 2011). This makes it easier to consider contiguous seasons. In contrast, <code>type = 'season'</code> will just split the data into four seasons regardless of the year.</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>If a categorical variable is present in a data frame e.g.&nbsp;<code>site</code> then that variables can be used directly e.g.&nbsp;<code>type = "site"</code>.</p>
<section id="make-your-own-type" class="level3" data-number="2.5.1"><h3 data-number="2.5.1" class="anchored" data-anchor-id="make-your-own-type">
<span class="header-section-number">2.5.1</span> Make your own type</h3>
<p>In some cases it is useful to categorise numeric variables according to one’s own intervals. One example is air quality bands where concentrations might be described as “good”, “fair”, “bad”. For this situation we can use the <code>cut</code> function. In the example below, concentrations of NO<sub>2</sub> are divided into intervals 0-50, 50-100, 100-150 and &gt;150 using the <code>breaks</code> option. Also shown are user-defined labels. Note there is 1 more break than label. There are a couple of things to note here. First, <code>include.lowest = TRUE</code> ensures that the lowest value is included in the lowest break (in this case 0). Second, the maximum value (1000) is set to be more than the maximum value in the data to ensure the final break encompasses all the data.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="va">mydata</span><span class="op">$</span><span class="va">intervals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">$</span><span class="va">no2</span>, </span>
<span>                        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">1000</span><span class="op">)</span>, </span>
<span>                        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="st">"Low"</span>, <span class="st">"High"</span>,</span>
<span>                                   <span class="st">"Very High"</span><span class="op">)</span>, </span>
<span>                        include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># look at the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  date                   ws    wd   nox   no2    o3  pm10   so2    co  pm25
  &lt;dttm&gt;              &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
1 1998-01-01 00:00:00  0.6    280   285    39     1    29  4.72  3.37    NA
2 1998-01-01 01:00:00  2.16   230    NA    NA    NA    37 NA    NA       NA
3 1998-01-01 02:00:00  2.76   190    NA    NA     3    34  6.83  9.60    NA
4 1998-01-01 03:00:00  2.16   170   493    52     3    35  7.66 10.2     NA
5 1998-01-01 04:00:00  2.4    180   468    78     2    34  8.07  8.91    NA
6 1998-01-01 05:00:00  3      190   264    42     0    16  5.50  3.05    NA
# ℹ 1 more variable: intervals &lt;fct&gt;</code></pre>
</div>
</div>
<p>Then it is possible to use the new <code>intervals</code> variable in most <span class="pkg">openair</span> functions e.g.&nbsp;<code>windRose(mydata, type = "intervals")</code>.</p>
<p>A special case is splitting data by date. In this scenario there might be interest in a ‘before-after’ situation e.g.&nbsp;due to an intervention. The <span class="pkg">openair</span> function <code>splitByDate</code> should make this easy. Here is an example:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/splitByDate.html">splitByDate</a></span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  dates <span class="op">=</span> <span class="st">"1/1/2003"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"before"</span>, <span class="st">"after"</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"scenario"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 65,533 × 12
   date                   ws    wd   nox   no2    o3  pm10   so2    co  pm25
   &lt;dttm&gt;              &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1 1998-01-01 00:00:00  0.6    280   285    39     1    29  4.72  3.37    NA
 2 1998-01-01 01:00:00  2.16   230    NA    NA    NA    37 NA    NA       NA
 3 1998-01-01 02:00:00  2.76   190    NA    NA     3    34  6.83  9.60    NA
 4 1998-01-01 03:00:00  2.16   170   493    52     3    35  7.66 10.2     NA
 5 1998-01-01 04:00:00  2.4    180   468    78     2    34  8.07  8.91    NA
 6 1998-01-01 05:00:00  3      190   264    42     0    16  5.50  3.05    NA
 7 1998-01-01 06:00:00  3      140   171    38     0    11  4.23  2.26    NA
 8 1998-01-01 07:00:00  3      170   195    51     0    12  3.88  2.00    NA
 9 1998-01-01 08:00:00  3.36   170   137    42     1    12  3.35  1.46    NA
10 1998-01-01 09:00:00  3.96   170   113    39     2    12  2.92  1.20    NA
# ℹ 65,523 more rows
# ℹ 2 more variables: intervals &lt;fct&gt;, scenario &lt;ord&gt;</code></pre>
</div>
</div>
<p>This code adds a new column <code>scenario</code> that is labelled <code>before</code> and <code>after</code> depending on the date. Note that the <code>dates</code> input by the user is in British format (dd/mm/YYYY) and that several dates (and labels) can be provided.</p>
</section></section><section id="font-size" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="font-size">
<span class="header-section-number">2.6</span> Controlling font size</h2>
<p>All <span class="pkg">openair</span> plot functions have an option <code>fontsize</code>. Users can easily vary the size of the font for each plot e.g.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span>, fontsize <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The font size will be reset to the default sizes once the plot is complete. Finer control of individual font sizes is currently not easily possible.</p>
</section><section id="colours" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="colours">
<span class="header-section-number">2.7</span> Using colours</h2>
<p>Many of the functions described require that colour scales are used; particularly for plots showing surfaces. It is only necessary to consider using other colours if the user does not wish to use the default scheme, shown at the top of <a href="#fig-colours" class="quarto-xref">Figure&nbsp;<span>2.1</span></a>. The choice of colours does seem to be a vexing issue as well as something that depends on what one is trying to show in the first place. For this reason, the colour schemes used in <span class="pkg">openair</span> are very flexible: if you don’t like them, you can change them easily. R itself can handle colours in many sophisticated ways; see for example the <code>RColorBrewer</code> package.</p>
<p>Several pre-defined colour schemes are available to make it easy to plot data. In fact, for most situations the default colour schemes should be adequate. The choice of colours can easily be set; either by using one of the pre-defined schemes or through a user-defined scheme. More details can be found in the <span class="pkg">openair</span> <code>openColours</code> function. Some defined colours are shown in <a href="#fig-colours" class="quarto-xref">Figure&nbsp;<span>2.1</span></a>, together with an example of a user defined scale that provides a smooth transition from red to green.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openair/">openair</a></span><span class="op">)</span></span>
<span><span class="co">## small function for plotting</span></span>
<span><span class="va">printCols</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">col</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/rect.html">rect</a></span><span class="op">(</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span> <span class="op">/</span> <span class="fl">200</span>, <span class="va">y</span>, <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">201</span><span class="op">)</span> <span class="op">/</span> <span class="fl">200</span>, <span class="va">y</span> <span class="op">+</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/openColours.html">openColours</a></span><span class="op">(</span><span class="va">col</span>, n <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>,</span>
<span>       border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">y</span> <span class="op">+</span> <span class="fl">0.15</span>, <span class="fu"><a href="https://rdrr.io/r/base/deparse.html">deparse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## plot an empty plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fl">1</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.6</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"n"</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>,</span>
<span>     axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="st">"default"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="st">"increment"</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="st">"heat"</span>, <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="st">"turbo"</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="st">"viridis"</span>, <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="st">"inferno"</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="st">"greyscale"</span>, <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu">printCols</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tomato"</span>, <span class="st">"white"</span>, <span class="st">"forestgreen"</span> <span class="op">)</span>, <span class="fl">1.4</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-colours" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-colours-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="openair-package_files/figure-html/fig-colours-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;2.1: elected pre-defined colour scales in. The top colour scheme is a user-defined one."><img src="openair-package_files/figure-html/fig-colours-1.png" class="img-fluid figure-img" style="width:70.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-colours-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: elected pre-defined colour scales in. The top colour scheme is a user-defined one.
</figcaption></figure>
</div>
</div>
</div>
<p>The user-defined scheme is very flexible and the following provides examples of its use. In the examples shown next, the <code>polarPlot</code> function is used as a demonstration of their use.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="co"># use default colours - no need to specify</span></span>
<span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use pre-defined "turbo" colours</span></span>
<span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span>, cols <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define own colours going from yellow to green</span></span>
<span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define own colours going from red to white to blue</span></span>
<span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>For more detailed information on using appropriate colours, have a look at the <a href="https://cran.r-project.org/web/packages/colorspace/vignettes/colorspace.html">colorspace</a> package. <span class="pkg">colorspace</span> provides the definitive, comprehensive approach to using colours effectively. You will need to install the package, <code>install.packages("colorspace")</code>. To use the palettes with <span class="pkg">openair</span>, you can for example do:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://colorspace.R-Forge.R-project.org/">colorspace</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openair/">openair</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/windRose.html">windRose</a></span><span class="op">(</span><span class="va">mydata</span>, cols <span class="op">=</span> <span class="fu"><a href="https://colorspace.R-Forge.R-project.org/reference/hcl_palettes.html">qualitative_hcl</a></span><span class="op">(</span><span class="fl">4</span>, palette <span class="op">=</span> <span class="st">"Dark 3"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-colorspace" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-colorspace-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="openair-package_files/figure-html/fig-colorspace-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2.2: A demonstration of the colorspace package in use with openair."><img src="openair-package_files/figure-html/fig-colorspace-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-colorspace-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: A demonstration of the <span class="pkg">colorspace</span> package in use with <span class="pkg">openair</span>.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="quickText" class="level2" data-number="2.8"><h2 data-number="2.8" class="anchored" data-anchor-id="quickText">
<span class="header-section-number">2.8</span> Automatic text formatting</h2>
<p><span class="pkg">openair</span> tries to automate the process of annotating plots. It can be time-consuming (and tricky) to repetitively type in text to represent μg m<sup>-3</sup> or PM<sub>10</sub> (μg m<sup>-3</sup>) etc. in R. For this reason, an attempt is made to automatically detect strings such as <code>nox</code> or <code>NOx</code> and format them correctly. Where a user needs a y-axis label such as NO<sub>x</sub> (μg m<sup>-3</sup>) it will only be necessary to type <code>ylab = "nox (ug/m3)"</code>. The same is also true for plot titles.</p>
<p>Users can override this option by setting it to FALSE.</p>
</section><section id="sec-multiple-plots-page" class="level2" data-number="2.9"><h2 data-number="2.9" class="anchored" data-anchor-id="sec-multiple-plots-page">
<span class="header-section-number">2.9</span> Multiple plots on a page</h2>
<p>We often get asked how to combine multiple plots on one page. Recent changes to <span class="pkg">openair</span> makes this a bit easier. Note that because <span class="pkg">openair</span> uses <span class="pkg">lattice</span> graphics the base graphics <code>par</code> settings will not work.</p>
<p>It is possible to arrange plots based on a column <span class="math inline">\(\times\)</span> row layout. Let’s put two plots side by side (2 columns, 1 row). First it is necessary to assign the plots to a variable:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/windRose.html">windRose</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now we can plot them using the <code>split</code> option:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">a</span>, split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">b</span>, split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, newpage <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>In the code above for the <code>split</code> option, the last two numbers give the overall layout (2, 1) — 2 columns, 1 row. The first two numbers give the column/row index for that particular plot. The last two numbers remain constant across the series of plots being plotted.</p>
<p>There is one difficulty with plots that already contain sub-plots such as <code>timeVariation</code> where it is necessary to identify the particular plot of interest (see the <code>timeVariation</code> help for details). However, say we want a polar plot (<code>b</code> above) and a diurnal plot:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/timeVariation.html">timeVariation</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">b</span>, split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">c</span>, split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, subset <span class="op">=</span> <span class="st">"hour"</span>, newpage <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>For more control it is possible to use the <code>position</code> argument. <code>position</code> is a vector of 4 numbers, c(xmin, ymin, xmax, ymax) that give the lower-left and upper-right corners of a rectangle in which the plot is to be positioned. The coordinate system for this rectangle is [0–1] in both the x and y directions.</p>
<p>As an example, consider plotting the first plot in the lower left quadrant and the second plot in the upper right quadrant:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">a</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, more <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">b</span>, position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The position argument gives more fine control over the plot location.</p>
</section><section id="saving-plots-and-data" class="level2 page-columns page-full" data-number="2.10"><h2 data-number="2.10" class="anchored" data-anchor-id="saving-plots-and-data">
<span class="header-section-number">2.10</span> Saving plots and data</h2>
<p>While you’ll likely be using <span class="pkg">openair</span> in an environment like <a href="https://rstudio.com/products/rstudio/">RStudio</a>, you’ll likely want to get the outputs of your analysis <em>outside</em> of RStudio to put into reports, papers, or other deliverables.</p>
<p>For data, this is relatively straightforward. The <code><a href="https://rdrr.io/r/utils/write.table.html">write.csv()</a></code> function will write out a dataframe to a local file path. The only arguments it really needs is <code>x</code> (the dataframe to save) and <code>file</code> (the file path to save it to). For example, the below code chunk will load annual statistics for the Marylebone Road monitoring site, and save them to the path <code>"my1_annual-stats_2022.csv"</code>. Always try to give files evocative names so you’ll know what’s in them in future - <code>"my1_annual-stats_2022.csv"</code> is better than <code>"data.csv"</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openair/">openair</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">marylebone</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/importUKAQ.html">importUKAQ</a></span><span class="op">(</span>site <span class="op">=</span> <span class="st">"my1"</span>,</span>
<span>             year <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>             source <span class="op">=</span> <span class="st">"aurn"</span>,</span>
<span>             data_type <span class="op">=</span> <span class="st">"annual"</span>, </span>
<span>             to_narrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">marylebone</span>, file <span class="op">=</span> <span class="st">"my1_annual-stats_2022.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Plots are slightly more complicated. If you do use RStudio, the simplest way to save an openair plot is to use the plots pane, visualised in <a href="#fig-rstudiosave" class="quarto-xref">Figure&nbsp;<span>2.3</span></a>. This menu will allow you to copy your plot to the clipboard, or save it as an image or PDF.</p>
<div id="fig-rstudiosave" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-rstudiosave-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../../images/rstudio-saving.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;2.3: A screenshot of the ‘Export’ menu of the RStudio plots pane."><img src="../../images/rstudio-saving.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rstudiosave-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: A screenshot of the ‘Export’ menu of the RStudio plots pane.
</figcaption></figure>
</div>
<p>This may be useful in some scenarios, but using the RStudio GUI is not very reproducible. For sake of example, say you make a new set of plots every week for a weekly report. You may not want to have to repeatedly go into the plots pane, click ‘export’, set the correct dimensions, and so on every time a new plot needs to be saved. It would be preferable if your script created the plots <em>and</em> saved them!</p>
<p>To write a script to save a plot, use the following approach:</p>
<ol type="1">
<li><p><strong>Create your <span class="pkg">openair</span> plot</strong>, making sure to assign it (<code>&lt;-</code>) to a variable name.</p></li>
<li><p><strong>Open a graphics device</strong>, such as <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code>, <code><a href="https://rdrr.io/r/grDevices/png.html">jpeg()</a></code>, <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code>, and so on. This is the stage where you’ll set parameters like the width, height, and resolution. You’ll also need to define a path, much like when you save data. As before, give it an evocative name - <code>"polarplot_marylebone_nox.png"</code> is a lot more descriptive than <code>"myplot.png"</code>. You’ll note that a file is created in your working directory, but it will be blank for the moment.</p></li>
<li><p><strong>Print the plot</strong>. In <span class="pkg">openair</span>, this can typically achieved by simply printing the whole <span class="pkg">openair</span> object. Note that the plot will not appear in your plots pane in RStudio - it is being printed to the file you’ve created.</p></li>
<li><p><strong>Close the graphics device</strong>. This is simply achieved using <code><a href="https://rdrr.io/r/grDevices/dev.html">dev.off()</a></code> regardless of your chosen device, and tells R to close the connection to the device. The image of the plot will now appear in the file you created in step 2.</p></li>
</ol>

<div class="no-row-height column-margin column-container"><div class="">
<p>Many R users will be familiar with <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggplot2::ggsave()</a></code> for saving plots. <span class="pkg">openair</span> predates <span class="pkg">ggplot2</span>, so this function will not work with <span class="pkg">openair</span> plots.</p>
</div></div><div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openair/">openair</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># STEP 1: Make a polarPlot</span></span>
<span><span class="va">polar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span>, <span class="st">"nox"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># STEP 2: Open a graphics device</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"polarplot_marylebone_nox.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span>, units <span class="op">=</span> <span class="st">"in"</span>, res <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># STEP 3: Print the plot</span></span>
<span><span class="va">polar</span></span>
<span></span>
<span><span class="co"># STEP 4: Turn off the graphics device</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>You can read about R’s plotting devices by reading the “help” page for the <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code> function - type <code><a href="https://rdrr.io/r/grDevices/png.html">?png</a></code> into your console to bring it up.</p>
<p>The <span class="pkg">openairmaps</span> package can create interactive HTML maps. To save these, you need to use the <code><a href="https://rdrr.io/pkg/htmlwidgets/man/saveWidget.html">htmlwidgets::saveWidget()</a></code> function. This is simpler than saving a static plot as you will not have to worry about resolution or dimensions.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openairmaps/">openairmaps</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">polarmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap</a></span><span class="op">(</span><span class="va">polar_data</span>, <span class="st">"nox"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">htmlwidgets</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmlwidgets/man/saveWidget.html">saveWidget</a></span><span class="op">(</span>widget <span class="op">=</span> <span class="va">polarmap</span>, file <span class="op">=</span> <span class="st">"polarmap_london_nox.html"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Another way of sharing analysis produced using <span class="pkg">openair</span> is in <a href="https://quarto.org/">Quarto</a> (or <a href="https://rmarkdown.rstudio.com/">Rmarkdown</a>) reports. These well documented on their respective websites.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>As R help says: “Contrary to some expectations (but consistent with names such as ‘⁠PST8PDT⁠’), negative offsets are times ahead of (east of) UTC, positive offsets are times behind (west of) UTC.”<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/bookdown\.org\/david_carslaw\/openair\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../sections/intro/intro.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../sections/data-access/UK-air-quality-data.html" class="pagination-link" aria-label="Accessing UK Air Quality Data">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Accessing UK Air Quality Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/davidcarslaw/openair-book/edit/master/sections/intro/openair-package.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer><script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>


</body></html>