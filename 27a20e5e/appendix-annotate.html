<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="David Carslaw">
<title>The openair book - Appendix A — Annotating openair plots</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./appendix-hysplit.html" rel="next">
<link href="./references.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="style.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Appendix A — Annotating openair plots</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The openair book</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/davidcarslaw/openair-book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./openair-package.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The openair package</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Data Access</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./UK-air-quality-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Accessing UK Air Quality Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./access-met-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Access meteorological data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Directional Analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wind-roses.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Wind and Pollution Roses</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polar-freq.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Polar frequencies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./percentile-roses.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Percentile roses</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polar-plots.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Polar plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polar-annulus.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Polar annulus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./trajectory-analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Trajectory analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Time Series and Trends</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time series plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-variation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Temporal variations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-proportion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Time proportion plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./trend-level.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Trend heat maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calendar-plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Calendar plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./theil-sen.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Theil-Sen trends</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./smooth-trend.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Smooth trends</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Model Evaluation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mod-stats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Model evaluation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./taylor-diagram.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Taylor Diagam</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conditional-quantiles.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Conditional quantiles</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Interactive Maps</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-overview.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">openairmaps primer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-network.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Network Visualisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-polar.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Directional Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-traj.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Trajectory Analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Utility functions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utility-functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Utility functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scatter-plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Scatter plots</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-annotate.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Annotating openair plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-hysplit.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Production of HYSPLIT trajectory files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-trends.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">A closer look at trends</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#adding-text" id="toc-adding-text" class="nav-link active" data-scroll-target="#adding-text"><span class="toc-section-number">A.1</span>  Adding text</a></li>
  <li><a href="#adding-text-and-a-shaded-area" id="toc-adding-text-and-a-shaded-area" class="nav-link" data-scroll-target="#adding-text-and-a-shaded-area"><span class="toc-section-number">A.2</span>  Adding text and a shaded area</a></li>
  <li><a href="#adding-an-arrow" id="toc-adding-an-arrow" class="nav-link" data-scroll-target="#adding-an-arrow"><span class="toc-section-number">A.3</span>  Adding an arrow</a></li>
  <li><a href="#adding-a-reference-line-and-text" id="toc-adding-a-reference-line-and-text" class="nav-link" data-scroll-target="#adding-a-reference-line-and-text"><span class="toc-section-number">A.4</span>  Adding a reference line and text</a></li>
  <li><a href="#highlight-a-specific-point" id="toc-highlight-a-specific-point" class="nav-link" data-scroll-target="#highlight-a-specific-point"><span class="toc-section-number">A.5</span>  Highlight a specific point</a></li>
  <li><a href="#add-a-filled-polygon" id="toc-add-a-filled-polygon" class="nav-link" data-scroll-target="#add-a-filled-polygon"><span class="toc-section-number">A.6</span>  Add a filled polygon</a></li>
  <li><a href="#add-air-quality-bands-as-polygons" id="toc-add-air-quality-bands-as-polygons" class="nav-link" data-scroll-target="#add-air-quality-bands-as-polygons"><span class="toc-section-number">A.7</span>  Add air quality bands as polygons</a></li>
  <li><a href="#polar-plot-examples" id="toc-polar-plot-examples" class="nav-link" data-scroll-target="#polar-plot-examples"><span class="toc-section-number">A.8</span>  Polar plot examples</a></li>
  <li><a href="#using-grid-graphics-identify-locations-interactively" id="toc-using-grid-graphics-identify-locations-interactively" class="nav-link" data-scroll-target="#using-grid-graphics-identify-locations-interactively"><span class="toc-section-number">A.9</span>  Using grid graphics — identify locations interactively</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/davidcarslaw/openair-book/edit/master/appendix-annotate.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-annotating-openair" class="quarto-section-identifier d-none d-lg-block">Appendix A — Annotating openair plots</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Carslaw </p>
          </div>
  </div>
    
  
    
  </div>
  

</header><p>A frequently asked question about <span class="pkg">openair</span> and requested feature is how to annotate plots. While all <span class="pkg">openair</span> functions could have options to allow annotations to be made, this would make the functions cumbersome and reduce flexibility. Nevertheless, it is useful to be able to annotate plots in lots of different ways. Fortunately there are existing functions in packages such as <span class="pkg">lattice</span> and <span class="pkg">latticeExtra</span> that allow for plots to be updated. An example of the sorts of annotation that are possible is shown in <a href="#fig-timePlotAnnotate">Figure&nbsp;<span>A.1</span></a>, which is an enhanced version of a <code>timePlot</code> Figure. These annotations have been subsequently added to a basic plot and built up in layers. This section considers how to annotate <span class="pkg">openair</span> plots more generally and uses <a href="#fig-timePlotAnnotate">Figure&nbsp;<span>A.1</span></a> as an example of the types of annotation possible. Also considered specifically is the annotation of plots that are in polar coordinates, as these can sometimes benefit from different types of annotation.</p>
<p>There are several types of objects that can be useful to add to plots including text, shapes, lines and other shading. Given that many <span class="pkg">openair</span> plots can consist of multiple panels, it is also useful to think about how to annotate specific panels. The examples given in this section will apply to all <span class="pkg">openair</span> plot, the only difference being the coordinate system used in each case.</p>
<p>The basis of <span class="pkg">openair</span> annotations is through the use of the <span class="pkg">latticeExtra</span> package, which should already be installed as part of <span class="pkg">openair</span>. In that package there is a function called <code>layer</code> that effectively allows annotations to be built up ‘layer by layer’.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/fig-timePlotAnnotate_536477373301d5871320357da9ff4554">
<div class="cell-output-display">
<div id="fig-timePlotAnnotate" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="appendix-annotate_files/figure-html/fig-timePlotAnnotate-1.png" class="img-fluid figure-img" width="960"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;A.1: Annotations added to the <code>timePlot</code>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="adding-text" class="level2" data-number="A.1"><h2 data-number="A.1" class="anchored" data-anchor-id="adding-text">
<span class="header-section-number">A.1</span> Adding text</h2>
<p>To add text (or other annotations) it is necessary to know the coordinates on a plot for where the text will go, which will depend on the data plotted. In this extended example using the <code>timePlot</code> function, the y-axis will be in ordinary numerical units, whereas the x-axis will be in a date-time format (<code>POSIXct</code>).</p>
<p>There are various ways that annotations can be added, but the method used here is to add to the previous plot using a function called <code><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object()</a></code> to which we want to add a later. This may seem complicated, but once a few examples are considered, the method becomes very powerful, flexible and straightforward. In a multi-panel plot such as <a href="#fig-timePlotAnnotate">Figure&nbsp;<span>A.1</span></a> it is also useful to specify which rows/columns should be added to. If they are not specified then the annotation will appear in all panels.</p>
<p>First, a plot should be produced to which we wish to add some text.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotatePbase_376ea6f6dd64f9f1bf49ff183c913751">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## make sure latticeExtra is loaded</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openair/">openair</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://latticeextra.r-forge.r-project.org/">latticeExtra</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/timePlot.html">timePlot</a></span><span class="op">(</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/selectByDate.html">selectByDate</a></span><span class="op">(</span><span class="va">mydata</span>, year <span class="op">=</span> <span class="fl">2003</span>, month <span class="op">=</span> <span class="st">"aug"</span><span class="op">)</span>,</span>
<span>         pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nox"</span>, <span class="st">"o3"</span>, <span class="st">"pm25"</span>, <span class="st">"pm10"</span>, <span class="st">"ws"</span><span class="op">)</span>,</span>
<span>         y.relation <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, considering @ref(fig:timePlotAnnotate), this is how the text `some missing data’ was added to the top panel.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP1_62e961d9fce0ce1ee5d57b18506868df">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">ltext</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-04 12:00"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                labels <span class="op">=</span> <span class="st">"some missing data"</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So what does this do? First, the <code><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object()</a></code> is simply the last plot that was plotted. Next the <code>layer</code> function is used to add some text. The text itself is added using the <code>ltext</code> <span class="pkg">lattice</span> function. It is worth having a look at the help for <code>ltext</code> as that gives an overview of all the common annotations and other options. We have chosen to plot the text at position x = ‘2003-08-04’ and y = 200 and the label itself. A useful option to <code>ltext</code> is <code>pos</code>. Values can be 1, 2, 3 and 4, and indicate positions below (the default), to the left of, above and to the right of the specified coordinates</p>
</section><section id="adding-text-and-a-shaded-area" class="level2" data-number="A.2"><h2 data-number="A.2" class="anchored" data-anchor-id="adding-text-and-a-shaded-area">
<span class="header-section-number">A.2</span> Adding text and a shaded area</h2>
<p>This time we will highlight an interval in row 2 (O<sub>3</sub>) and write some text on top. Note that this time we use the <code>lpolygon</code> function and choose to put it under everything else on the plot. For the text, we have chosen a colour (yellow) font type 2 (bold) and made it a bit bigger (<code>cex = 1.5</code>). Note also the <code>y</code> values extend beyond the actual limits shown on the plot — just to make sure they cover the whole region.</p>
<p>The polygon could of course be horizontal and more than one producing a series of ‘bands’ e.g.&nbsp;air quality indexes. A more sophisticated approach is shown later for PM<sub>2.5</sub></p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP2_3dac833d2278fe5254df95c66b6d5a45">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## add shaded polygon</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">lpolygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-07 00:00"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-07 00:00"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-12 00:00"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-12 00:00"</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">600</span>, <span class="fl">600</span>, <span class="op">-</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>                   col <span class="op">=</span> <span class="st">"grey"</span>, border <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, under <span class="op">=</span> <span class="cn">TRUE</span>, rows <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## add text</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">ltext</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-09 12:00"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                labels <span class="op">=</span> <span class="st">"!!episode!!"</span>, col <span class="op">=</span> <span class="st">"yellow"</span>,</span>
<span>                font <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The small shaded, semi-transparent area shown in the bottom panel was added as follows:</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP2a_3fcae0c350846bab45f9693a74023e33">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## add shaded polygon</span></span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">lpolygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2003-08-21"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2003-08-21"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-23 00:00"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-23 00:00"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">8</span>, <span class="fl">4</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, border <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                   alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="adding-an-arrow" class="level2" data-number="A.3"><h2 data-number="A.3" class="anchored" data-anchor-id="adding-an-arrow">
<span class="header-section-number">A.3</span> Adding an arrow</h2>
<p>The arrow shown on the first panel of <a href="#fig-timePlotAnnotate">Figure&nbsp;<span>A.1</span></a> was added as follows. Note the <code>code = 3</code> placed arrows at both ends. Note that <code>angle</code> is the angle from the shaft of the arrow to the edge of the arrow head.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP3_9c7e817911482cd73abb6d391fb0ed3d">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">larrows</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-01 00:00"</span><span class="op">)</span>, <span class="fl">100</span>,</span>
<span>                  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-08 14:00"</span><span class="op">)</span>,</span>
<span>                  <span class="fl">100</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="adding-a-reference-line-and-text" class="level2" data-number="A.4"><h2 data-number="A.4" class="anchored" data-anchor-id="adding-a-reference-line-and-text">
<span class="header-section-number">A.4</span> Adding a reference line and text</h2>
<p>This code adds a vertical dashed reference line shown in the 4th panel (PM<sub>10</sub>) along with some text aligned at 90 degrees using the <code>srt</code> option of <code>ltext</code>.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP4_7d18fe1ab7a7983eedb581a96ed460c2">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.functions.html">panel.abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-25 00:00"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>          rows <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">ltext</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-25 08:00"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">60</span>,</span>
<span>                labels <span class="op">=</span> <span class="st">"reference line"</span>, srt <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="highlight-a-specific-point" class="level2" data-number="A.5"><h2 data-number="A.5" class="anchored" data-anchor-id="highlight-a-specific-point">
<span class="header-section-number">A.5</span> Highlight a specific point</h2>
<p>Up until now annotations have been added using arbitrary coordinates in each panel. What if we wanted to highlight a particular point, or more generally work with the actual data that are plotted. Knowing how to refer to existing data greatly extends the power of these functions.</p>
<p>It is possible to refer to a specific point in a panel simply by indexing the point of interest i.e.&nbsp;<code>x</code>, <code>y</code>. For example, to mark the 200th PM<sub>10</sub> concentration (without knowing the actual date or value):</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP5_e4eb6fa2d03e06243c854aabbf0198af">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## add a specific point</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">lpoints</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">200</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="fl">200</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>          rows <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What if we wanted to highlight the maximum O<sub>3</sub> concentration? It is possible to work out the index first and then use that to refer to that point. Note the <code>}</code> to allow for the code to span multiple commands.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP6_5658d344291620a500ac4d8303d6cfda">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## add a point to the max O3 concentration</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="op">{</span><span class="va">maxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>;</span>
<span>           <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">lpoints</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">maxy</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">maxy</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"black"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">}</span>,</span>
<span>          rows <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## label max ozone</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="op">{</span><span class="va">maxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>;</span>
<span>           <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">ltext</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">maxy</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">maxy</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">maxy</span><span class="op">]</span>, <span class="st">"ppb"</span><span class="op">)</span>,</span>
<span>                 pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">}</span>, rows <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="add-a-filled-polygon" class="level2" data-number="A.6"><h2 data-number="A.6" class="anchored" data-anchor-id="add-a-filled-polygon">
<span class="header-section-number">A.6</span> Add a filled polygon</h2>
<p>It can be seen in the top panel of <a href="#fig-timePlotAnnotate">Figure&nbsp;<span>A.1</span></a> that some data are highlighted by filling the area below the line. This approach can be useful more generally in plotting. While it is possible to draw polygons easily and refer to the data itself, there needs to be a way for dealing with gaps in data, otherwise these gaps could be filled in perhaps unpredictable ways. A function has been written to draw a polygon taking into account gaps (<code>poly.na</code>).</p>
<div class="cell" data-hash="appendix-annotate_cache/html/polyNA_f5f51fc7794c69c715f741b443b1606f">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poly.na</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">y1</span>, <span class="va">x2</span>, <span class="va">y2</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">y2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">lpolygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x1</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span>, <span class="va">x1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">x2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">x2</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y1</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span>, <span class="va">y1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">y2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">y2</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>               col <span class="op">=</span> <span class="va">col</span>, border <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This time we work out the ids of the data spanning an area of interest. Then the <code>poly.na</code> function is used. Note that the alpha transparency is by default 0.2 but another value can easily be supplied, as shown in the air quality ‘bands’ example.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP7_09df2a4052c0bf85e1ef0bbbc42d4924">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="op">{</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-11 00:00"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                       <span class="va">x</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hm</a></span><span class="op">(</span><span class="st">"2003-08-25 00:00"</span><span class="op">)</span><span class="op">)</span>;</span>
<span>           <span class="fu">poly.na</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="va">id</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   col <span class="op">=</span> <span class="st">"darkorange"</span><span class="op">)</span><span class="op">}</span>, rows <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="add-air-quality-bands-as-polygons" class="level2" data-number="A.7"><h2 data-number="A.7" class="anchored" data-anchor-id="add-air-quality-bands-as-polygons">
<span class="header-section-number">A.7</span> Add air quality bands as polygons</h2>
<p>It is a simple extension to go from using a polygon below the data to polygons at certain intervals e.g.&nbsp;air quality indexes. These are shown for PM<sub>2.5</sub> and the bands considered are 0–20, 20–30, 30–40 and &gt;40.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotateP8_c3b8006f9299d6b648920beada6ee331">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu">poly.na</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  col <span class="op">=</span> <span class="st">"green"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu">poly.na</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span><span class="fl">20</span>, <span class="cn">NA</span>, <span class="va">y</span><span class="op">)</span>, <span class="va">x</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"yellow"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>          rows <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu">poly.na</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span><span class="fl">30</span>, <span class="cn">NA</span>, <span class="va">y</span><span class="op">)</span>,</span>
<span>                  <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  col <span class="op">=</span> <span class="st">"orange"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu">poly.na</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;</span><span class="fl">40</span>, <span class="cn">NA</span>, <span class="va">y</span><span class="op">)</span>,</span>
<span>                  <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  col <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="polar-plot-examples" class="level2" data-number="A.8"><h2 data-number="A.8" class="anchored" data-anchor-id="polar-plot-examples">
<span class="header-section-number">A.8</span> Polar plot examples</h2>
<p>Many of the examples considered above are relevant to all other functions e.g.&nbsp;how to add text, choosing rows and columns to plot in. Polar coordinate plots are different because of the coordinate system used and this section considers a few examples.</p>
<p>One useful approach is to be able to draw an arc, perhaps highlighting an area of interest. A simple, but flexible function has been written to do this. It takes arguments <code>theta1</code> and <code>theta2</code> that define the angular area of interest and <code>lower</code> and <code>upper</code> to set the lower and upper wind speed, respectively. It also has additional arguments <code>theta3</code> and <code>theta4</code> which optionally set the angles for the ‘upper’ wind speed.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/arcCode_a773838227ccd603b00d5d77507bc17c">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">arc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta1</span> <span class="op">=</span> <span class="fl">30</span>, <span class="va">theta2</span> <span class="op">=</span> <span class="fl">60</span>, <span class="va">theta3</span> <span class="op">=</span> <span class="va">theta1</span>, <span class="va">theta4</span> <span class="op">=</span> <span class="va">theta2</span>,</span>
<span>                <span class="va">lower</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">upper</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">## function to work out coordinates for an arc sector</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">theta2</span> <span class="op">&lt;</span> <span class="va">theta1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ang1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">theta1</span>, <span class="fl">360</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta2</span> <span class="op">-</span> <span class="va">theta1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">ang2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">theta2</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta2</span> <span class="op">-</span> <span class="va">theta1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">angles.low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ang1</span>, <span class="va">ang2</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">## for upper angles</span></span>
<span>    <span class="va">ang1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">theta1</span>, <span class="fl">360</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta4</span> <span class="op">-</span> <span class="va">theta3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">ang2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">theta2</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta4</span> <span class="op">-</span> <span class="va">theta3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">angles.high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ang1</span>, <span class="va">ang2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">angles.low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">theta1</span>, <span class="va">theta2</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta2</span> <span class="op">-</span> <span class="va">theta1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">angles.high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">theta3</span>, <span class="va">theta4</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta4</span> <span class="op">-</span> <span class="va">theta3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">lower</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">angles.low</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span></span>
<span>  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="va">lower</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">angles.low</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span></span>
<span>  <span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">angles.high</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">angles.high</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y1</span>, <span class="va">y2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="appendix-annotate_cache/html/fig-annonatePolar_a0bd9e5081238245b3940183c3d41b76">
<div class="cell-output-display">
<div id="fig-annonatePolar" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="appendix-annotate_files/figure-html/fig-annonatePolar-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;A.2: Annotations on a polar plot.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Following on from the previous examples, some annotations have been added to the basic polar plot for SO<sub>2</sub> as shown in <a href="#fig-annonatePolar">Figure&nbsp;<span>A.2</span></a>. Note that in these plots (0, 0) is the middle of the plot and the radial distance will be determined by the wind speed — or whatever the radial variable is. This way of plotting arcs can also be applied to other functions that show directional data.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/annotatePolar1_61d5013300192ffdf45d406f6695096d">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">mydata</span>, pollutant <span class="op">=</span> <span class="st">"so2"</span>, col <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">ltext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">12</span>, <span class="op">-</span><span class="fl">12</span>, <span class="st">"A"</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">ltext</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">2</span>, <span class="st">"B"</span>, cex <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">lsegments</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">11.5</span>, <span class="op">-</span><span class="fl">11.5</span>, lty <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## add and arc to highlight area of interest</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/update.trellis.html">trellis.last.object</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">lpolygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">arc</span><span class="op">(</span>theta1 <span class="op">=</span> <span class="fl">60</span>, theta2 <span class="op">=</span> <span class="fl">120</span>, lower <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                   upper <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="fu">arc</span><span class="op">(</span>theta1 <span class="op">=</span> <span class="fl">60</span>,</span>
<span>                                  theta2 <span class="op">=</span> <span class="fl">120</span>, lower <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                  upper <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="using-grid-graphics-identify-locations-interactively" class="level2" data-number="A.9"><h2 data-number="A.9" class="anchored" data-anchor-id="using-grid-graphics-identify-locations-interactively">
<span class="header-section-number">A.9</span> Using grid graphics — identify locations interactively</h2>
<p>The examples above provide a precise way of annotating plots for single or multi-panels <span class="pkg">openair</span> displays. However, these methods won’t work for plots that consist of completely separate plots such as the four plots in <code>timeVariation</code>. There are however other methods that can be used to annotate such plots using the package <code>grid</code>, which forms the basis of <span class="pkg">lattice</span> graphics. There is enormous capability for annotating plots using the <code>grid</code> package and only a few simple examples are given here.</p>
<p>Given a a basic <code>timeVariation</code> plot, how could texts be added at any location — say in the middle monthly plot? One very useful function for this type of annotation that allows the user to interactively choose a location is the <code><a href="https://rdrr.io/r/grid/grid.locator.html">grid.locator()</a></code> function in the <code>grid</code> package. That function can be called with different coordinate systems — but the one we want defines the bottom-left corner as (0, 0) and the top right as (1, 1).</p>
<p>First, make a <code>timeVariation</code> plot.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/timeVarGrid_2bb0004ca71197bece7c6b90348d75b4">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/timeVariation.html">timeVariation</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s choose a location on the plot interactively using the mouse and selecting somewhere in the middle of the monthly plot.</p>
<div class="cell" data-hash="appendix-annotate_cache/html/gridLocate_7d3565dab14ca9a116d7837b04250b7e">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="co">## bring up the interactive location chooser</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.locator.html">grid.locator</a></span><span class="op">(</span>unit <span class="op">=</span> <span class="st">"npc"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What should happen is that in the R console the coordinates are given for that point. In my case these were x = 0.503 and y = 0.338. These coordinates can now be used as the basis of adding some text or other annotation. In the example below, the <code>grid.text</code> function is used to add some text for these coordinates making the font bigger (<code>cex = 2</code>), bold (<code>font = 2</code>) and blue (<code>col = "blue"</code>).</p>
<div class="cell" data-hash="appendix-annotate_cache/html/addGridText_d098bfecb42b392395eded6575d352a8">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.503</span>, y <span class="op">=</span> <span class="fl">0.338</span>, label <span class="op">=</span> <span class="st">"here!"</span>,</span>
<span>          gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">2</span>, font <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Even with this basic approach, some sophisticated annotation is possible with <em>any</em> <span class="pkg">openair</span> plot. There are many other functions that can be used from the grid package that would allow for polygons, segments and other features to be drawn is a similar way to the examples earlier in this section. Continuing with the same example, here is how to add an arrow pointing to the maximum concentration shown on the top plot for Saturday (again using the <code>grid.locator</code> function).</p>
<div class="cell" data-hash="appendix-annotate_cache/html/addGridArrow_b72764b68a0d84ff7e8dc980a568d20e">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grid/grid.lines.html">grid.lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.736</span>, <span class="fl">0.760</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.560</span>, <span class="fl">0.778</span><span class="op">)</span>,</span>
<span>           arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.736</span>, y <span class="op">=</span> <span class="fl">0.560</span>, label <span class="op">=</span> <span class="st">"maximum"</span>, just <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./references.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">References</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./appendix-hysplit.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Production of HYSPLIT trajectory files</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>