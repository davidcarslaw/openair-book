<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jack Davison">
<title>The openair book - 23&nbsp; Directional Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./maps-traj.html" rel="next">
<link href="./maps-network.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="site_libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><script src="site_libs/jquery-1.12.4/jquery.min.js"></script><link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script><link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script><script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="site_libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><link rel="stylesheet" href="style.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">
<span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Directional Analysis</span>
</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The openair book</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/davidcarslaw/openair-book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./openair-package.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The openair package</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Data Access</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./UK-air-quality-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Accessing UK Air Quality Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./access-met-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Access meteorological data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Directional Analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wind-roses.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Wind and Pollution Roses</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polar-freq.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Polar frequencies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./percentile-roses.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Percentile roses</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polar-plots.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Polar plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polar-annulus.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Polar annulus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./trajectory-analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Trajectory analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Time Series and Trends</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time series plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-variation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Temporal variations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-proportion.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Time proportion plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./trend-level.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Trend heat maps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calendar-plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Calendar plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./theil-sen.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Theil-Sen trends</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./smooth-trend.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Smooth trends</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Model Evaluation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mod-stats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Model evaluation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./taylor-diagram.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Taylor Diagam</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conditional-quantiles.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Conditional quantiles</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Interactive Maps</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-overview.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">openairmaps primer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-network.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Network Visualisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-polar.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Directional Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps-traj.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Trajectory Analysis</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Utility functions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utility-functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Utility functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scatter-plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Scatter plots</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-annotate.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Annotating openair plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-hysplit.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Production of HYSPLIT trajectory files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-trends.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">A closer look at trends</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#data-requirements" id="toc-data-requirements" class="nav-link active" data-scroll-target="#data-requirements"><span class="toc-section-number">23.1</span>  Data Requirements</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="toc-section-number">23.2</span>  Overview</a></li>
  <li><a href="#simple-demonstrations" id="toc-simple-demonstrations" class="nav-link" data-scroll-target="#simple-demonstrations"><span class="toc-section-number">23.3</span>  Simple Demonstrations</a></li>
  <li><a href="#colour-scales" id="toc-colour-scales" class="nav-link" data-scroll-target="#colour-scales"><span class="toc-section-number">23.4</span>  Colour Scales</a></li>
  <li><a href="#use-of-control" id="toc-use-of-control" class="nav-link" data-scroll-target="#use-of-control"><span class="toc-section-number">23.5</span>  Use of <code>control</code></a></li>
  <li><a href="#building-popups" id="toc-building-popups" class="nav-link" data-scroll-target="#building-popups"><span class="toc-section-number">23.6</span>  Building Popups</a></li>
  <li><a href="#marker-function" id="toc-marker-function" class="nav-link" data-scroll-target="#marker-function"><span class="toc-section-number">23.7</span>  Marker Function</a></li>
  <li><a href="#static-maps" id="toc-static-maps" class="nav-link" data-scroll-target="#static-maps"><span class="toc-section-number">23.8</span>  Static Maps</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/davidcarslaw/openair-book/edit/master/maps-polar.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">
<span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Directional Analysis</span>
</h1>
<p class="subtitle lead">Putting polar plots on an interactive map</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jack Davison </p>
          </div>
  </div>
    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    One of the headline features of <code>openairmaps</code> is creating maps using directional analysis plots as markers. Being able to place a polar plot or similar visualisation on a map can allow us to gain additional insight from our analysis, permitting us to easily compare different sites and further understand their geographic context. This page introduces the <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> family of functions, and the suite of customisations available to users.
  </div>
</div>

</header><section id="data-requirements" class="level2 page-columns page-full" data-number="23.1"><h2 data-number="23.1" class="anchored" data-anchor-id="data-requirements">
<span class="header-section-number">23.1</span> Data Requirements</h2>
<p><span class="pkg">openairmaps</span> contains the <code>polar_data</code> dataset to allow users to test the directional analysis functions. The structure of this data set is provided below, and a summary is given in <a href="#tbl-polardata">Table&nbsp;<span>23.1</span></a>. The important feature of this data when compared to <code><a href="https://davidcarslaw.github.io/openair/reference/mydata.html">openair::mydata</a></code> is latitude and longitude information, which <span class="pkg">openairmaps</span> needs to place the directional analysis markers in the correct positions.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openairmaps/">openairmaps</a></span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">polar_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 35,040
Columns: 13
$ date       &lt;dttm&gt; 2009-01-01 00:00:00, 2009-01-01 01:00:00, 2009-01-01 02:00…
$ nox        &lt;dbl&gt; 113, 40, 48, 36, 40, 50, 50, 53, 80, 111, 206, 113, 86, 82,…
$ no2        &lt;dbl&gt; 46, 32, 36, 29, 32, 36, 34, 34, 50, 59, 67, 61, 52, 53, 52,…
$ pm2.5      &lt;dbl&gt; 42, 45, 43, 37, 36, 33, 33, 31, 27, 28, 37, 30, 27, 29, 27,…
$ pm10       &lt;dbl&gt; 46, 49, 46, NA, 38, 32, 36, 32, 30, 32, 39, 37, 32, 33, 34,…
$ site       &lt;chr&gt; "London Bloomsbury", "London Bloomsbury", "London Bloomsbur…
$ lat        &lt;dbl&gt; 51.52229, 51.52229, 51.52229, 51.52229, 51.52229, 51.52229,…
$ lon        &lt;dbl&gt; -0.125889, -0.125889, -0.125889, -0.125889, -0.125889, -0.1…
$ site_type  &lt;chr&gt; "Urban Background", "Urban Background", "Urban Background",…
$ wd         &lt;dbl&gt; 58.92536, 74.46675, 30.00000, 45.00000, 70.00000, 46.63627,…
$ ws         &lt;dbl&gt; 2.066667, 1.900000, 1.550000, 2.100000, 1.500000, 2.100000,…
$ visibility &lt;dbl&gt; 5000.000, 4933.333, 5000.000, 4900.000, 5000.000, 6000.000,…
$ air_temp   &lt;dbl&gt; 0.8666667, 0.8666667, 0.8000000, 0.8500000, 0.8666667, 0.96…</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-polardata" class="anchored">

<div id="oovtvbcpos" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#oovtvbcpos) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#oovtvbcpos) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#oovtvbcpos) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#oovtvbcpos) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#oovtvbcpos) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#oovtvbcpos) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#oovtvbcpos) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#oovtvbcpos) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#oovtvbcpos) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#oovtvbcpos) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#oovtvbcpos) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#oovtvbcpos) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#oovtvbcpos) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#oovtvbcpos) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#oovtvbcpos) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#oovtvbcpos) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#oovtvbcpos) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#oovtvbcpos) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#oovtvbcpos) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#oovtvbcpos) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#oovtvbcpos) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#oovtvbcpos) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#oovtvbcpos) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#oovtvbcpos) .gt_left {
  text-align: left;
}

:where(#oovtvbcpos) .gt_center {
  text-align: center;
}

:where(#oovtvbcpos) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#oovtvbcpos) .gt_font_normal {
  font-weight: normal;
}

:where(#oovtvbcpos) .gt_font_bold {
  font-weight: bold;
}

:where(#oovtvbcpos) .gt_font_italic {
  font-style: italic;
}

:where(#oovtvbcpos) .gt_super {
  font-size: 65%;
}

:where(#oovtvbcpos) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#oovtvbcpos) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#oovtvbcpos) .gt_indent_1 {
  text-indent: 5px;
}

:where(#oovtvbcpos) .gt_indent_2 {
  text-indent: 10px;
}

:where(#oovtvbcpos) .gt_indent_3 {
  text-indent: 15px;
}

:where(#oovtvbcpos) .gt_indent_4 {
  text-indent: 20px;
}

:where(#oovtvbcpos) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<caption>Table&nbsp;23.1:  A statistical summary of the polar_data dataset. </caption>
  
  <thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>London Bloomsbury</strong>, N = 8,760<sup class=&quot;gt_footnote_marks&quot;>1</sup>">
<strong>London Bloomsbury</strong>, N = 8,760<sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>London Cromwell Road 2</strong>, N = 8,760<sup class=&quot;gt_footnote_marks&quot;>1</sup>">
<strong>London Cromwell Road 2</strong>, N = 8,760<sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>London Marylebone Road</strong>, N = 8,760<sup class=&quot;gt_footnote_marks&quot;>1</sup>">
<strong>London Marylebone Road</strong>, N = 8,760<sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>London N. Kensington</strong>, N = 8,760<sup class=&quot;gt_footnote_marks&quot;>1</sup>">
<strong>London N. Kensington</strong>, N = 8,760<sup class="gt_footnote_marks">1</sup>
</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="label" class="gt_row gt_left">date</td>
<td headers="stat_1" class="gt_row gt_center">2009-01-01 to 2009-12-31 23:00:00</td>
<td headers="stat_2" class="gt_row gt_center">2009-01-01 to 2009-12-31 23:00:00</td>
<td headers="stat_3" class="gt_row gt_center">2009-01-01 to 2009-12-31 23:00:00</td>
<td headers="stat_4" class="gt_row gt_center">2009-01-01 to 2009-12-31 23:00:00</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">nox</td>
<td headers="stat_1" class="gt_row gt_center">71 (44, 122)</td>
<td headers="stat_2" class="gt_row gt_center">138 (96, 199)</td>
<td headers="stat_3" class="gt_row gt_center">258 (139, 418)</td>
<td headers="stat_4" class="gt_row gt_center">34 (19, 65)</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">no2</td>
<td headers="stat_1" class="gt_row gt_center">52 (36, 71)</td>
<td headers="stat_2" class="gt_row gt_center">69 (53, 88)</td>
<td headers="stat_3" class="gt_row gt_center">99 (67, 141)</td>
<td headers="stat_4" class="gt_row gt_center">29 (15, 48)</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">pm2.5</td>
<td headers="stat_1" class="gt_row gt_center">13 (10, 19)</td>
<td headers="stat_2" class="gt_row gt_center">NA (NA, NA)</td>
<td headers="stat_3" class="gt_row gt_center">19 (13, 27)</td>
<td headers="stat_4" class="gt_row gt_center">10 (7, 17)</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">pm10</td>
<td headers="stat_1" class="gt_row gt_center">16 (11, 23)</td>
<td headers="stat_2" class="gt_row gt_center">NA (NA, NA)</td>
<td headers="stat_3" class="gt_row gt_center">31 (21, 43)</td>
<td headers="stat_4" class="gt_row gt_center">17 (12, 24)</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">lat</td>
<td headers="stat_1" class="gt_row gt_center">51.522</td>
<td headers="stat_2" class="gt_row gt_center">51.495</td>
<td headers="stat_3" class="gt_row gt_center">51.523</td>
<td headers="stat_4" class="gt_row gt_center">51.521</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">lon</td>
<td headers="stat_1" class="gt_row gt_center">-0.126</td>
<td headers="stat_2" class="gt_row gt_center">-0.179</td>
<td headers="stat_3" class="gt_row gt_center">-0.155</td>
<td headers="stat_4" class="gt_row gt_center">-0.213</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">wd</td>
<td headers="stat_1" class="gt_row gt_center">213 (134, 265)</td>
<td headers="stat_2" class="gt_row gt_center">213 (134, 265)</td>
<td headers="stat_3" class="gt_row gt_center">213 (134, 265)</td>
<td headers="stat_4" class="gt_row gt_center">213 (134, 265)</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">ws</td>
<td headers="stat_1" class="gt_row gt_center">3.77 (2.60, 5.30)</td>
<td headers="stat_2" class="gt_row gt_center">3.77 (2.60, 5.30)</td>
<td headers="stat_3" class="gt_row gt_center">3.77 (2.60, 5.30)</td>
<td headers="stat_4" class="gt_row gt_center">3.77 (2.60, 5.30)</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">visibility</td>
<td headers="stat_1" class="gt_row gt_center">14,436 (11,177, 16,843)</td>
<td headers="stat_2" class="gt_row gt_center">14,436 (11,177, 16,843)</td>
<td headers="stat_3" class="gt_row gt_center">14,436 (11,177, 16,843)</td>
<td headers="stat_4" class="gt_row gt_center">14,436 (11,177, 16,843)</td>
</tr>
<tr>
<td headers="label" class="gt_row gt_left">air_temp</td>
<td headers="stat_1" class="gt_row gt_center">12 (7, 16)</td>
<td headers="stat_2" class="gt_row gt_center">12 (7, 16)</td>
<td headers="stat_3" class="gt_row gt_center">12 (7, 16)</td>
<td headers="stat_4" class="gt_row gt_center">12 (7, 16)</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr>
<td class="gt_footnote" colspan="5">
<sup class="gt_footnote_marks">1</sup> Range; Median (IQR); Median</td>
    </tr></tfoot>
</table>
</div>
</div>
</div>
</div>
<p>If you would prefer to use data from different sites or years, the <code>import*()</code> functions from <span class="pkg">openair</span> make it easy to obtain pollution data with associated site latitude/longitude. The key thing to remember is to use the <code>meta = TRUE</code> argument when using a function like <code><a href="https://davidcarslaw.github.io/openair/reference/importAURN.html">importAURN()</a></code> to have the lat/lon (&amp; site type) appended to your imported data.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sunderland</span> <span class="op">&lt;-</span> <span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/importAURN.html">importAURN</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sun2"</span>, <span class="st">"sunr"</span><span class="op">)</span>, year <span class="op">=</span> <span class="fl">2015</span>, meta <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sunderland</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "site"      "code"      "date"      "nox"       "no2"       "no"       
 [7] "o3"        "pm2.5"     "v2.5"      "nv2.5"     "ws"        "wd"       
[13] "air_temp"  "latitude"  "longitude" "site_type"</code></pre>
</div>
</div>
<p>By “directional analysis”, we are referring to the outputs from <span class="pkg">openair</span> functions like <code><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot()</a></code>. As a reminder as to what these figures look like, see <a href="#fig-openairplots">Figure&nbsp;<span>23.1</span></a>.</p>
<div class="page-columns page-full">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarAnnulus.html">polarAnnulus</a></span><span class="op">(</span><span class="va">polar_data</span><span class="op">)</span></span>
<span><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarFreq.html">polarFreq</a></span><span class="op">(</span><span class="va">polar_data</span><span class="op">)</span></span>
<span><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/percentileRose.html">percentileRose</a></span><span class="op">(</span><span class="va">polar_data</span><span class="op">)</span></span>
<span><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot</a></span><span class="op">(</span><span class="va">polar_data</span><span class="op">)</span></span>
<span><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/pollutionRose.html">pollutionRose</a></span><span class="op">(</span><span class="va">polar_data</span><span class="op">)</span></span>
<span><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/windRose.html">windRose</a></span><span class="op">(</span><span class="va">polar_data</span><span class="op">)</span></span>
<span><span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/polarDiff.html">polarDiff</a></span><span class="op">(</span><span class="va">polar_data</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">polar_data</span>, nox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html">jitter</a></span><span class="op">(</span><span class="va">nox</span>, factor <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-openairplots" class="cell column-body-outset quarto-layout-panel">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-openairplots-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="maps-polar_files/figure-html/fig-openairplots-1.png" class="img-fluid figure-img" data-ref-parent="fig-openairplots" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Polar Annulus</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-openairplots-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="maps-polar_files/figure-html/fig-openairplots-2.png" class="img-fluid figure-img" data-ref-parent="fig-openairplots" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Polar Frequency</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-openairplots-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="maps-polar_files/figure-html/fig-openairplots-3.png" class="img-fluid figure-img" data-ref-parent="fig-openairplots" width="672"></p>
<p></p><figcaption class="figure-caption">(c) Percentile Rose</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-openairplots-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="maps-polar_files/figure-html/fig-openairplots-4.png" class="img-fluid figure-img" data-ref-parent="fig-openairplots" width="672"></p>
<p></p><figcaption class="figure-caption">(d) Polar Plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-openairplots-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="maps-polar_files/figure-html/fig-openairplots-5.png" class="img-fluid figure-img" data-ref-parent="fig-openairplots" width="672"></p>
<p></p><figcaption class="figure-caption">(e) Pollution Rose</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-openairplots-6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="maps-polar_files/figure-html/fig-openairplots-6.png" class="img-fluid figure-img" data-ref-parent="fig-openairplots" width="672"></p>
<p></p><figcaption class="figure-caption">(f) Wind Rose</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-openairplots-7" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="maps-polar_files/figure-html/fig-openairplots-7.png" class="img-fluid figure-img" data-ref-parent="fig-openairplots" width="672"></p>
<p></p><figcaption class="figure-caption">(g) Polar Diff</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;23.1: All of the directional analysis figures which can be plotted on a map.</figcaption><p></p>
</figure>
</div>
</div>
</section><section id="overview" class="level2" data-number="23.2"><h2 data-number="23.2" class="anchored" data-anchor-id="overview">
<span class="header-section-number">23.2</span> Overview</h2>
<p>The easiest way to get polar plots on a map is through the use of the all-in-one mapping functions. These are all named using the pattern <code>{function-name}Map</code>, where <code>{function_name}</code> is a short hand for the equivalent <span class="pkg">openair</span> function. A reference is provided in <a href="#tbl-dirAnalysisRef">Table&nbsp;<span>23.2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-dirAnalysisRef" class="anchored">

<div id="rikgiltbpa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#rikgiltbpa) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#rikgiltbpa) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#rikgiltbpa) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#rikgiltbpa) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#rikgiltbpa) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#rikgiltbpa) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#rikgiltbpa) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#rikgiltbpa) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#rikgiltbpa) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#rikgiltbpa) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#rikgiltbpa) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#rikgiltbpa) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#rikgiltbpa) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#rikgiltbpa) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#rikgiltbpa) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#rikgiltbpa) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#rikgiltbpa) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#rikgiltbpa) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#rikgiltbpa) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#rikgiltbpa) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#rikgiltbpa) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#rikgiltbpa) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#rikgiltbpa) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#rikgiltbpa) .gt_left {
  text-align: left;
}

:where(#rikgiltbpa) .gt_center {
  text-align: center;
}

:where(#rikgiltbpa) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#rikgiltbpa) .gt_font_normal {
  font-weight: normal;
}

:where(#rikgiltbpa) .gt_font_bold {
  font-weight: bold;
}

:where(#rikgiltbpa) .gt_font_italic {
  font-style: italic;
}

:where(#rikgiltbpa) .gt_super {
  font-size: 65%;
}

:where(#rikgiltbpa) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#rikgiltbpa) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#rikgiltbpa) .gt_indent_1 {
  text-indent: 5px;
}

:where(#rikgiltbpa) .gt_indent_2 {
  text-indent: 10px;
}

:where(#rikgiltbpa) .gt_indent_3 {
  text-indent: 15px;
}

:where(#rikgiltbpa) .gt_indent_4 {
  text-indent: 20px;
}

:where(#rikgiltbpa) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<caption>Table&nbsp;23.2:  A reference table for openairmaps directional analysis mapping functions. </caption>
  
  <thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="openair">openair</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="openairmaps">openairmaps</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="scale arguments">scale arguments</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="unique arguments">unique arguments</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="openair" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openair/reference/polarAnnulus.html">polarAnnulus()</a></code></p>
</div></td>
<td headers="openairmaps" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openairmaps/reference/annulusMap.html">annulusMap()</a></code></p>
</div></td>
<td headers="scale arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>limits</code></p>
</div></td>
<td headers="unique arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>period</code></p>
</div></td>
</tr>
<tr>
<td headers="openair" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openair/reference/polarFreq.html">polarFreq()</a></code></p>
</div></td>
<td headers="openairmaps" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openairmaps/reference/freqMap.html">freqMap()</a></code></p>
</div></td>
<td headers="scale arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>breaks</code></p>
</div></td>
<td headers="unique arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>statistic</code></p>
</div></td>
</tr>
<tr>
<td headers="openair" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openair/reference/percentileRose.html">percentileRose()</a></code></p>
</div></td>
<td headers="openairmaps" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openairmaps/reference/percentileMap.html">percentileMap()</a></code></p>
</div></td>
<td headers="scale arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>percentile</code></p>
</div></td>
<td headers="unique arguments" class="gt_row gt_left"><div class="gt_from_md">
<p>--</p>
</div></td>
</tr>
<tr>
<td headers="openair" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot()</a></code></p>
</div></td>
<td headers="openairmaps" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code></p>
</div></td>
<td headers="scale arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>limits</code></p>
</div></td>
<td headers="unique arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>x</code></p>
</div></td>
</tr>
<tr>
<td headers="openair" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openair/reference/pollutionRose.html">pollutionRose()</a></code></p>
</div></td>
<td headers="openairmaps" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openairmaps/reference/pollroseMap.html">pollroseMap()</a></code></p>
</div></td>
<td headers="scale arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>breaks</code></p>
</div></td>
<td headers="unique arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>statistic</code></p>
</div></td>
</tr>
<tr>
<td headers="openair" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openair/reference/windRose.html">windRose()</a></code></p>
</div></td>
<td headers="openairmaps" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openairmaps/reference/windroseMap.html">windroseMap()</a></code></p>
</div></td>
<td headers="scale arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>ws.int</code>, <code>breaks</code></p>
</div></td>
<td headers="unique arguments" class="gt_row gt_left"><div class="gt_from_md">
<p>--</p>
</div></td>
</tr>
<tr>
<td headers="openair" class="gt_row gt_left"><div class="gt_from_md">
<p><code><a href="https://davidcarslaw.github.io/openair/reference/polarDiff.html">polarDiff()</a></code></p>
</div></td>
<td headers="openairmaps" class="gt_row gt_left"><div class="gt_from_md">
<p>`diffMap()</p>
</div></td>
<td headers="scale arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>limits</code></p>
</div></td>
<td headers="unique arguments" class="gt_row gt_left"><div class="gt_from_md">
<p><code>x</code></p>
</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Effectively all of these functions have very similar arguments, although some are unique to the specific function (also shown in <a href="#tbl-dirAnalysisRef">Table&nbsp;<span>23.2</span></a>). The important ones to pay attention to are:</p>
<ul>
<li>
<code>data</code>: The data you would like to map. Ensure that lat/lon information is present.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
</li>
</ul>
<ul>
<li><p><code>pollutant</code>: The pollutant(s) of interest. If multiple pollutants are provided, a “layer control” menu will allow readers to swap between them.</p></li>
<li><p><code>latitude</code>, <code>longitude</code>: The lat/lon column names. If they are not specified, the functions will attempt to guess them based on common names (e.g., “lon”, “lng”, “long” and “longitude” for <code>longitude</code>).</p></li>
<li><p><code>control</code>: A column to use to create a “layer control” menu. Specifying <code>control</code> effectively splits the input data along the specified column, creating multiple separate sets of directional analysis plots. Common columns to pass to <code>control</code> will be those created by <code><a href="https://davidcarslaw.github.io/openair/reference/cutData.html">openair::cutData()</a></code> or <code><a href="https://davidcarslaw.github.io/openair/reference/splitByDate.html">openair::splitByDate()</a></code>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p></li>
</ul>
<ul>
<li><p><code>popup</code>: A column to be used to create a HTML “popup” that appears when users click the markers. This would be useful to label each marker with its corresponding site name or code, although other information could be usefully included (e.g., site type, average pollutant concentrations, and so on). A more complicated popup can be created using the <code><a href="https://davidcarslaw.github.io/openairmaps/reference/buildPopup.html">buildPopup()</a></code> function.</p></li>
<li><p><code>label</code>: Much the same as “popup”, but the message will appear when users hover-over the marker rather than click on it. Labels are often much shorter than popups.</p></li>
<li><p><code>provider</code>: The <span class="pkg">leaflet</span> base map provider(s) you’d like to use. If multiple providers are provided, a “layer control” menu will allow readers to swap between them. Note that you can provide multiple pollutants <em>and</em> providers!</p></li>
<li><p>The “scale” arguments (e.g., <code>limits</code> for <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code>). By specifying a scale, all polar markers will use the same colour scale, making them quantitatively comparable to one another. Specifying a scale will also draw a shared legend at the top-right of the plot, unless <code>draw.legend</code> is set to <code>FALSE</code>.</p></li>
<li><p><code>alpha</code>: Controls the transparency of the polar markers, as sometimes making them semi-transparent may be desirable (for examples, if they are slightly overlapping, or seeing more of the basemap is useful). <code>alpha</code> should be a number between 0 and 1, where 1 is completely opaque and 0 is completely transparent.</p></li>
<li><p>The two “marker diameter” arguments, which control the size and resolution of the polar markers. It is assumed that circular markers are desired, so any number provided will be used as the marker width <em>and</em> height. If, for whatever reason, a non-circular marker is desired, a vector in the form <code>c(width, height)</code> can be provided.</p></li>
<li><p><code>d.icon</code> changes the actual size of the markers on the map, defaulting to 200.</p></li>
<li><p><code>d.fig</code> changes the size of the actual <code>openair</code> figure, defaulting to 3.5 inches. In practice, this translates to changing the resolution of the figure on the map, so you should look to adjust <code>d.fig</code> in the same direction as <code>d.icon</code> so that the axis scales remain readable.</p></li>
<li><p><code>...</code>: Any additional arguments to pass to the equivalent <span class="pkg">openair</span> function.</p></li>
</ul></section><section id="simple-demonstrations" class="level2" data-number="23.3"><h2 data-number="23.3" class="anchored" data-anchor-id="simple-demonstrations">
<span class="header-section-number">23.3</span> Simple Demonstrations</h2>
<p><code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> is demonstrated in <a href="#fig-polarMap">Figure&nbsp;<span>23.2</span></a>. Try clicking on each of the markers to see which sites they correspond to.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap</a></span><span class="op">(</span></span>
<span>  <span class="va">polar_data</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  popup <span class="op">=</span> <span class="st">"site"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-polarMap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9d9e655b59e2cdc78e16" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9d9e655b59e2cdc78e16">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[51.52229,51.52253,51.52105,51.495483],[-0.125889,-0.154611,-0.213492,-0.178709],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_nox_20230220210833.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_nox_20230220210833.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_nox_20230220210833.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_nox_20230220210833.png"],"index":[0,1,2,3]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,["NO<sub>x<\/sub>","NO<sub>x<\/sub>","NO<sub>x<\/sub>","NO<sub>x<\/sub>"],{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["London Bloomsbury","London Marylebone Road","London N. Kensington","London Cromwell Road 2"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[51.495483,51.52253],"lng":[-0.213492,-0.125889]}},"evals":[],"jsHooks":[]}</script><p></p><figcaption class="figure-caption">Figure&nbsp;23.2: A demonstration of <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code>.</figcaption><p></p>
</figure>
</div>
</div>
<p>Another example, this time using <code><a href="https://davidcarslaw.github.io/openairmaps/reference/annulusMap.html">annulusMap()</a></code>, is given in <a href="#fig-annulusMap">Figure&nbsp;<span>23.3</span></a>. Note that this time there are two different pollutants plotted, which can be swapped between using the layer control menu. <span class="pkg">openairmaps</span> automatically deals with subscripts in common pollutant names.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/annulusMap.html">annulusMap</a></span><span class="op">(</span></span>
<span>  <span class="va">polar_data</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nox"</span>, <span class="st">"no2"</span><span class="op">)</span>, </span>
<span>  provider <span class="op">=</span> <span class="st">"CartoDB.Positron"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"lon"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-annulusMap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-08cbf8874fc09bcec48e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-08cbf8874fc09bcec48e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,"CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[51.52229,51.52229,51.52253,51.52253,51.52105,51.52105,51.495483,51.495483],[-0.125889,-0.125889,-0.154611,-0.154611,-0.213492,-0.213492,-0.178709,-0.178709],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_nox_20230220210836.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_no2_20230220210836.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_nox_20230220210836.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_no2_20230220210836.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_nox_20230220210836.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_no2_20230220210836.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_nox_20230220210836.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_no2_20230220210836.png"],"index":[0,1,2,3,4,5,6,7]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,["NO<sub>x<\/sub>","NO<sub>2<\/sub>","NO<sub>x<\/sub>","NO<sub>2<\/sub>","NO<sub>x<\/sub>","NO<sub>2<\/sub>","NO<sub>x<\/sub>","NO<sub>2<\/sub>"],{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["NO<sub>x<\/sub>","NO<sub>2<\/sub>"],[],{"collapsed":false,"autoZIndex":false,"position":"topright"}]}],"limits":{"lat":[51.495483,51.52253],"lng":[-0.213492,-0.125889]}},"evals":[],"jsHooks":[]}</script><p></p><figcaption class="figure-caption">Figure&nbsp;23.3: A more complex demonstration, this time using <code><a href="https://davidcarslaw.github.io/openairmaps/reference/annulusMap.html">annulusMap()</a></code>.</figcaption><p></p>
</figure>
</div>
</div>
</section><section id="colour-scales" class="level2" data-number="23.4"><h2 data-number="23.4" class="anchored" data-anchor-id="colour-scales">
<span class="header-section-number">23.4</span> Colour Scales</h2>
<p><a href="#fig-polarMap">Figure&nbsp;<span>23.2</span></a> could be described as using <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> in a “qualitative” mode — each site is using its own colour scale, so they cannot be easily compared quantitatively. There are two ways to use <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> in a more “quantitative” way:</p>
<ol type="1">
<li><p>Use the appropriate “scale” argument to set a colour scale that all markers will share. For <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> (and <code><a href="https://davidcarslaw.github.io/openairmaps/reference/annulusMap.html">annulusMap()</a></code>) this is the “limits” argument, which works the same way as in <code><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot()</a></code> (and <code>annulusPlot()</code>). In fact, all of the “scales” arguments shown in <a href="#tbl-dirAnalysisRef">Table&nbsp;<span>23.2</span></a> work in the exact same way as their corresponding <span class="pkg">openair</span> function. Setting a shared scale will draw an easy-to-read shared legend, which can be disabled using the <code>draw.legend</code> argument.</p></li>
<li><p>Set the <code>key</code> argument to be <code>TRUE</code>, which will draw the colour bar next to each individual marker. This may be advantageous if one site is much more polluted compared to another one, but the individual colour bars can be confusing and difficult to read depending on the chosen base map.</p></li>
</ol>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Shared Scale</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Distinct Scales</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap</a></span><span class="op">(</span></span>
<span>  <span class="va">polar_data</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  popup <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>  limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-polarMapShare" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-c3d84ce4aced7c591768" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-c3d84ce4aced7c591768">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[51.52229,51.52253,51.52105,51.495483],[-0.125889,-0.154611,-0.213492,-0.178709],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_nox_20230220210844.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_nox_20230220210844.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_nox_20230220210844.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_nox_20230220210844.png"],"index":[0,1,2,3]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,["NO<sub>x<\/sub>","NO<sub>x<\/sub>","NO<sub>x<\/sub>","NO<sub>x<\/sub>"],{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["London Bloomsbury","London Marylebone Road","London N. Kensington","London Cromwell Road 2"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#30123B , #30123B 0%, #389BF1 20%, #4FF380 40%, #DBD935 60%, #ED5E15 80%, #7A0403 100%, #7A0403 "],"labels":["0","100","200","300","400","500"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"topright","type":"numeric","title":"NO<sub>x<\/sub>","extra":{"p_1":0,"p_n":1},"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[51.495483,51.52253],"lng":[-0.213492,-0.125889]}},"evals":[],"jsHooks":[]}</script><p></p><figcaption class="figure-caption">Figure&nbsp;23.4: A demonstration of <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> with a shared colour scale.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap</a></span><span class="op">(</span></span>
<span>  <span class="va">polar_data</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  popup <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>  key <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-polarMapDistinct" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-524ef93c01fb2d4518a4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-524ef93c01fb2d4518a4">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[51.52229,51.52253,51.52105,51.495483],[-0.125889,-0.154611,-0.213492,-0.178709],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_nox_20230220210847.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_nox_20230220210847.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_nox_20230220210847.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_nox_20230220210847.png"],"index":[0,1,2,3]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,["NO<sub>x<\/sub>","NO<sub>x<\/sub>","NO<sub>x<\/sub>","NO<sub>x<\/sub>"],{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["London Bloomsbury","London Marylebone Road","London N. Kensington","London Cromwell Road 2"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[51.495483,51.52253],"lng":[-0.213492,-0.125889]}},"evals":[],"jsHooks":[]}</script><p></p><figcaption class="figure-caption">Figure&nbsp;23.5: A demonstration of <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> with individual colour scales.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section><section id="use-of-control" class="level2" data-number="23.5"><h2 data-number="23.5" class="anchored" data-anchor-id="use-of-control">
<span class="header-section-number">23.5</span> Use of <code>control</code>
</h2>
<p><a href="#fig-controlMap">Figure&nbsp;<span>23.6</span></a> uses <code><a href="https://davidcarslaw.github.io/openairmaps/reference/percentileMap.html">percentileMap()</a></code> and demonstrates how to use the “control” option to create a custom “layer control” menu and “label” and “popup” to label the markers, as well as passing on arguments to the equivalent <span class="pkg">openair</span> function — in this case, passing the “intervals” argument to <code><a href="https://davidcarslaw.github.io/openair/reference/percentileRose.html">percentileRose()</a></code> so that all of the markers are on the same radial axis.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polar_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/cutData.html">cutData</a></span><span class="op">(</span><span class="st">"weekend"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/percentileMap.html">percentileMap</a></span><span class="op">(</span></span>
<span>    pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>    control <span class="op">=</span> <span class="st">"weekend"</span>,</span>
<span>    latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>    longitude <span class="op">=</span> <span class="st">"lon"</span>, </span>
<span>    provider <span class="op">=</span> <span class="st">"Esri.WorldTopoMap"</span>,</span>
<span>    cols <span class="op">=</span> <span class="st">"viridis"</span>,</span>
<span>    popup <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"site_type"</span>,</span>
<span>    intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">800</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-controlMap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-bfd9582037671edc5f0b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-bfd9582037671edc5f0b">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,"Esri.WorldTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[51.52229,51.52253,51.52105,51.495483,51.52229,51.52253,51.52105,51.495483],[-0.125889,-0.154611,-0.213492,-0.178709,-0.125889,-0.154611,-0.213492,-0.178709],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_weekday_20230220210850.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_weekday_20230220210850.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_weekday_20230220210850.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_weekday_20230220210850.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_weekend_20230220210850.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_weekend_20230220210850.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_weekend_20230220210850.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_weekend_20230220210850.png"],"index":[0,1,2,3,4,5,6,7]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,["weekday","weekday","weekday","weekday","weekend","weekend","weekend","weekend"],{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["London Bloomsbury","London Marylebone Road","London N. Kensington","London Cromwell Road 2","London Bloomsbury","London Marylebone Road","London N. Kensington","London Cromwell Road 2"],null,null,null,["Urban Background","Urban Traffic","Urban Background","Urban Traffic","Urban Background","Urban Traffic","Urban Background","Urban Traffic"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["weekday","weekend"],[],{"collapsed":false,"autoZIndex":false,"position":"topright"}]},{"method":"addLegend","args":[{"colors":["#440154","#3E5087","#2D8F89","#6CC65E","#FDE725"],"labels":["0 &ndash; 25","25 &ndash; 50","50 &ndash; 75","75 &ndash; 90","90 &ndash; 95"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"topright","type":"bin","title":"Percentile","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[51.495483,51.52253],"lng":[-0.213492,-0.125889]}},"evals":[],"jsHooks":[]}</script><p></p><figcaption class="figure-caption">Figure&nbsp;23.6: A demonstration of <code><a href="https://davidcarslaw.github.io/openairmaps/reference/percentileMap.html">percentileMap()</a></code> using the ‘control’ option and passing arguments to <code><a href="https://davidcarslaw.github.io/openair/reference/percentileRose.html">openair::percentileRose()</a></code>.</figcaption><p></p>
</figure>
</div>
</div>
</section><section id="building-popups" class="level2" data-number="23.6"><h2 data-number="23.6" class="anchored" data-anchor-id="building-popups">
<span class="header-section-number">23.6</span> Building Popups</h2>
<p>So far, popups have used a single column to label the markers, but you will often want to encode more data than just the site name or type. For example, you may want to use the site name <em>and</em> type <em>and</em> the average wind speed <em>and</em> the dates it was active! To do so, you can use the <code><a href="https://davidcarslaw.github.io/openairmaps/reference/buildPopup.html">buildPopup()</a></code> function. This function has a handful of arguments:</p>
<ul>
<li><p><code>data</code>: the data you are going to use with, e.g., <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code>.</p></li>
<li><p><code>cols</code>: the columns you would like to encode in your popup.</p></li>
<li><p><code>latitude</code> &amp; <code>longitude</code>: the decimal latitude/longitude, which <code><a href="https://davidcarslaw.github.io/openairmaps/reference/buildPopup.html">buildPopup()</a></code> will use to identify individual sites to create labels for.</p></li>
<li><p><code>names</code>: a named vector used to rename columns in the popup.</p></li>
<li><p><code>control</code>: optional. This should only be used if you are going to use the <code>control</code> option in, e.g., <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMap.html">polarMap()</a></code> and you’d expect different popups for the different layers (i.e., it isn’t needed for site names/types, but it is needed for pollutant concentrations).</p></li>
<li><p><code>fun.character</code>, <code>fun.numeric</code> &amp; <code>fun.dttm</code>: the functions used to summarise character/factor, numeric, and date-time columns. These have nice defaults, but you may wish to override them.</p></li>
</ul>
<p>Think of <code><a href="https://davidcarslaw.github.io/openairmaps/reference/buildPopup.html">buildPopup()</a></code> as an intermediate between your data and the polar mapping function. All it does on its own is return the input data with a “popup” column appended, which can then be used with the <code>popup</code> argument of the mapping function. <a href="#fig-buildPopup">Figure&nbsp;<span>23.7</span></a> demonstrates the use of <code><a href="https://davidcarslaw.github.io/openairmaps/reference/buildPopup.html">buildPopup()</a></code> — try swapping between the layers and clicking on each of the markers.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polar_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">openair</span><span class="fu">::</span><span class="fu"><a href="https://davidcarslaw.github.io/openair/reference/cutData.html">cutData</a></span><span class="op">(</span><span class="st">"weekend"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/buildPopup.html">buildPopup</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="st">"site_type"</span>, <span class="st">"date"</span>, <span class="st">"nox"</span><span class="op">)</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Site"</span> <span class="op">=</span> <span class="st">"site"</span>,</span>
<span>      <span class="st">"Site Type"</span> <span class="op">=</span> <span class="st">"site_type"</span>,</span>
<span>      <span class="st">"Date Range"</span> <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>      <span class="st">"Average nox"</span> <span class="op">=</span> <span class="st">"nox"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    control <span class="op">=</span> <span class="st">"weekend"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/pollroseMap.html">pollroseMap</a></span><span class="op">(</span>pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>              popup <span class="op">=</span> <span class="st">"popup"</span>,</span>
<span>              breaks <span class="op">=</span> <span class="fl">6</span>,</span>
<span>              control <span class="op">=</span> <span class="st">"weekend"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-buildPopup" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a461dda0c74f5151f7d9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a461dda0c74f5151f7d9">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[51.52229,51.52253,51.52105,51.495483,51.52229,51.52253,51.52105,51.495483],[-0.125889,-0.154611,-0.213492,-0.178709,-0.125889,-0.154611,-0.213492,-0.178709],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_weekday_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_weekday_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_weekday_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_weekday_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_weekend_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_weekend_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_weekend_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_weekend_20230220210853.png"],"index":[0,1,2,3,4,5,6,7]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,["weekday","weekday","weekday","weekday","weekend","weekend","weekend","weekend"],{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["<b>Site<\/b>: London Bloomsbury<br><b>Site Type<\/b>: Urban Background<br><b>Average NO<sub>x<\/sub><\/b>: 98.3<br><b>Date Range<\/b>: 2009-01-01 to 2009-12-31","<b>Site<\/b>: London Marylebone Road<br><b>Site Type<\/b>: Urban Traffic<br><b>Average NO<sub>x<\/sub><\/b>: 330<br><b>Date Range<\/b>: 2009-01-01 to 2009-12-31","<b>Site<\/b>: London N. Kensington<br><b>Site Type<\/b>: Urban Background<br><b>Average NO<sub>x<\/sub><\/b>: 59.7<br><b>Date Range<\/b>: 2009-01-01 to 2009-12-31","<b>Site<\/b>: London Cromwell Road 2<br><b>Site Type<\/b>: Urban Traffic<br><b>Average NO<sub>x<\/sub><\/b>: 167<br><b>Date Range<\/b>: 2009-01-01 to 2009-12-31","<b>Site<\/b>: London Bloomsbury<br><b>Site Type<\/b>: Urban Background<br><b>Average NO<sub>x<\/sub><\/b>: 79<br><b>Date Range<\/b>: 2009-01-03 to 2009-12-27","<b>Site<\/b>: London Marylebone Road<br><b>Site Type<\/b>: Urban Traffic<br><b>Average NO<sub>x<\/sub><\/b>: 235<br><b>Date Range<\/b>: 2009-01-03 to 2009-12-27","<b>Site<\/b>: London N. Kensington<br><b>Site Type<\/b>: Urban Background<br><b>Average NO<sub>x<\/sub><\/b>: 42.1<br><b>Date Range<\/b>: 2009-01-03 to 2009-12-27","<b>Site<\/b>: London Cromwell Road 2<br><b>Site Type<\/b>: Urban Traffic<br><b>Average NO<sub>x<\/sub><\/b>: 133<br><b>Date Range<\/b>: 2009-01-03 to 2009-12-27"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["weekday","weekend"],[],{"collapsed":false,"autoZIndex":false,"position":"topright"}]},{"method":"addLegend","args":[{"colors":["#30123B","#446BDB","#2FB8E8","#3BED94","#9CF649","#E6CE37","#F77E20","#D03106","#7A0403"],"labels":["0 &ndash; 50","50 &ndash; 100","100 &ndash; 150","150 &ndash; 200","200 &ndash; 250","250 &ndash; 300","300 &ndash; 350","350 &ndash; 400","400 &ndash; 1,327"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"topright","type":"bin","title":"NO<sub>x<\/sub>","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[51.495483,51.52253],"lng":[-0.213492,-0.125889]}},"evals":[],"jsHooks":[]}</script><p></p><figcaption class="figure-caption">Figure&nbsp;23.7: A demonstration of the <code><a href="https://davidcarslaw.github.io/openairmaps/reference/buildPopup.html">buildPopup()</a></code> function.</figcaption><p></p>
</figure>
</div>
</div>
</section><section id="marker-function" class="level2" data-number="23.7"><h2 data-number="23.7" class="anchored" data-anchor-id="marker-function">
<span class="header-section-number">23.7</span> Marker Function</h2>
<p>The directional analysis marker function is <code><a href="https://davidcarslaw.github.io/openairmaps/reference/addPolarMarkers.html">addPolarMarkers()</a></code>, which behaves similarly (but not identically) to <code><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">leaflet::addMarkers()</a></code>. You will need to define the <code>data</code> you’re using, the <code>lat</code>/<code>lng</code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> columns, a column to distinguish different sites (<code>type</code>), and an <span class="pkg">openair</span> function (<code>fun</code>). As with <code><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">leaflet::addMarkers()</a></code> and similar functions, you can define <code>group</code> and <code>layerId</code>, which allows you to create more complex maps than can be achieved using the all-in-one <span class="pkg">openairmaps</span> functions.</p>
<p>To demonstrate, <a href="#fig-polarFreqMap">Figure&nbsp;<span>23.8</span></a> has been created. This uses the <code><a href="https://davidcarslaw.github.io/openair/reference/polarFreq.html">polarFreq()</a></code> function to plot multiple polar pollutant frequency plots for oxides of nitrogen. What is different about this map is that users can select the specific statistic they are interested in – in this case, mean, median or maximum. This is achieved by using the <code>group</code> arguments and <code><a href="https://rdrr.io/pkg/leaflet/man/addLayersControl.html">addLayersControl()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://davidcarslaw.github.io/openair/">openair</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span><span class="op">(</span></span>
<span>    <span class="st">"Stamen.Toner"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/addPolarMarkers.html">addPolarMarkers</a></span><span class="op">(</span></span>
<span>    lng <span class="op">=</span> <span class="st">"lon"</span>, lat <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>    pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"Mean"</span>,</span>
<span>    data <span class="op">=</span> <span class="va">polar_data</span>,</span>
<span>    fun <span class="op">=</span> <span class="va">polarFreq</span>,</span>
<span>    statistic <span class="op">=</span> <span class="st">"mean"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/addPolarMarkers.html">addPolarMarkers</a></span><span class="op">(</span></span>
<span>    lng <span class="op">=</span> <span class="st">"lon"</span>, lat <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>    pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"Median"</span>,</span>
<span>    data <span class="op">=</span> <span class="va">polar_data</span>,</span>
<span>    fun <span class="op">=</span> <span class="va">polarFreq</span>,</span>
<span>    statistic <span class="op">=</span> <span class="st">"median"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/addPolarMarkers.html">addPolarMarkers</a></span><span class="op">(</span></span>
<span>    lng <span class="op">=</span> <span class="st">"lon"</span>, lat <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>    pollutant <span class="op">=</span> <span class="st">"nox"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"Max"</span>,</span>
<span>    data <span class="op">=</span> <span class="va">polar_data</span>,</span>
<span>    fun <span class="op">=</span> <span class="va">polarFreq</span>,</span>
<span>    statistic <span class="op">=</span> <span class="st">"max"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLayersControl.html">addLayersControl</a></span><span class="op">(</span></span>
<span>    baseGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Mean"</span>, <span class="st">"Median"</span>, <span class="st">"Max"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-polarFreqMap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e0f68c7b48bd70b5bf27" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e0f68c7b48bd70b5bf27">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Stamen.Toner",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addMarkers","args":[[51.52229,51.495483,51.52253,51.52105],[-0.125889,-0.178709,-0.154611,-0.213492],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_dummyvar_20230220210854.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_dummyvar_20230220210854.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_dummyvar_20230220210854.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_dummyvar_20230220210854.png"],"index":[0,1,2,3]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,"Mean",{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addMarkers","args":[[51.52229,51.495483,51.52253,51.52105],[-0.125889,-0.178709,-0.154611,-0.213492],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_dummyvar_20230220210854.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_dummyvar_20230220210854.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_dummyvar_20230220210854.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_dummyvar_20230220210854.png"],"index":[0,1,2,3]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,"Median",{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addMarkers","args":[[51.52229,51.495483,51.52253,51.52105],[-0.125889,-0.178709,-0.154611,-0.213492],{"iconUrl":{"data":["/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52229_-0.125889_dummyvar_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.495483_-0.178709_dummyvar_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52253_-0.154611_dummyvar_20230220210853.png","/var/folders/lq/zhc5b_wd74v08qk87g0w_k7h0000gn/T//RtmpzmjnP5/51.52105_-0.213492_dummyvar_20230220210853.png"],"index":[0,1,2,3]},"iconWidth":200,"iconHeight":200,"iconAnchorX":100,"iconAnchorY":100},null,"Max",{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Mean","Median","Max"],[],{"collapsed":true,"autoZIndex":true,"position":"topright"}]}],"limits":{"lat":[51.495483,51.52253],"lng":[-0.213492,-0.125889]}},"evals":[],"jsHooks":[]}</script><p></p><figcaption class="figure-caption">Figure&nbsp;23.8: Using <code>addPolarMarkers</code> to create a more complex map.</figcaption><p></p>
</figure>
</div>
</div>
<p>One could imagine different applications, using this approach. For example:</p>
<ul>
<li><p>Giving users the option to swap between different <code>period</code>s for a <code><a href="https://davidcarslaw.github.io/openair/reference/polarAnnulus.html">polarAnnulus()</a></code> map, or different polar coordinates in a <code><a href="https://davidcarslaw.github.io/openair/reference/polarPlot.html">polarPlot()</a></code> map (i.e., different <code>x</code> arguments).</p></li>
<li><p>Allowing users to swap between different plot types (e.g., have “Wind Rose”, “Pollution Rose” and “Polar Plot” on the layer control menu).</p></li>
</ul>
<p>The options are pretty much endless for the kinds of things you could achieve using this approach. If one of the all-in-one functions doesn’t give you the flexibility you need, try to see if you can create your vision yourself from scratch using <span class="pkg">leaflet</span> and the <code><a href="https://davidcarslaw.github.io/openairmaps/reference/addPolarMarkers.html">addPolarMarkers()</a></code> function.</p>
</section><section id="static-maps" class="level2" data-number="23.8"><h2 data-number="23.8" class="anchored" data-anchor-id="static-maps">
<span class="header-section-number">23.8</span> Static Maps</h2>
<p>While interactive maps are useful for exploratory analysis and HTML documents/websites, there are numerous situations in which a static directional analysis map may be desired. For example, academic publications often demand submissions which compile to PDF. <span class="pkg">openairmaps</span> provides “static” versions of all seven directional analysis maps, identified by appending the word “Static” to the end of the corresponding interactive map (e.g., <code><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMapStatic.html">polarMapStatic()</a></code>).</p>
<p>The static maps are designed to be <em>almost</em> identical to the interactive maps, with very similar arguments to help easily switch between the two. There are a handful of exceptions, however:</p>
<ul>
<li><p>HTML maps have the <code>control</code> argument, whereas static maps have the <code>facet</code> argument. <code>facet</code> creates separate panels in the same figure in place of having a menu to switch between marker sets. Different panels are also created when multiple <code>pollutant</code>s are provided. The arrangement of these panels can be controlled using <code>facet.nrow</code>.</p></li>
<li><p>HTML maps use <span class="pkg">leaflet</span>, whereas static maps use <span class="pkg">ggplot2</span> and <span class="pkg">ggmap</span>. The functions automatically attempt to estimate an appropriate bounding box to draw the map. THe zoom of this map can be controlled using <code>zoom</code>, or users can provide their own map themselves using the <code>ggmap</code> argument. This latter argument takes the output of <code><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">ggmap::get_stamenmap()</a></code>.</p></li>
<li><p>Static maps naturally do not have the <code>popup</code> and <code>label</code> arguments. However, a benefit of being based in <span class="pkg">ggplot2</span> is that limited further customisation is possible, such as manually adding labels using <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">ggplot2::geom_label()</a></code>.</p></li>
<li><p>HTML maps have different default <code>d.icon</code> and <code>d.fig</code> values.</p></li>
</ul>
<p>An example “static map” is provided in <span class="quarto-unresolved-ref">?fig-polarMapStatic</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://davidcarslaw.github.io/openairmaps/reference/polarMapStatic.html">polarMapStatic</a></span><span class="op">(</span></span>
<span>  <span class="va">polar_data</span>,</span>
<span>  pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nox"</span>,<span class="st">"pm2.5"</span><span class="op">)</span>,</span>
<span>  latitude <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  longitude <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  d.icon <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  d.fig <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">.75</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p><code>data</code> is an option for all of the directional analysis maps, with the exception of <code><a href="https://davidcarslaw.github.io/openairmaps/reference/diffMap.html">diffMap()</a></code> which shares the <code>before</code> and <code>after</code> arguments with <code><a href="https://davidcarslaw.github.io/openair/reference/polarDiff.html">openair::polarDiff()</a></code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Note that maps can only have one “layer control” menu. Users should therefore only provide multiple pollutants <em>or</em> an argument to <code>control</code>, but never both. If multiple pollutants <em>and</em> <code>control</code> are specified, <code>control</code> will be ignored.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Marker functions use “lat” and “lng” as argument names for consistency with the leaflet package.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./maps-network.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Network Visualisation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./maps-traj.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Trajectory Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>